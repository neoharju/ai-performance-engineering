<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Systems Performance</title>
    <link rel="icon" type="image/png" href="img/ai_sys_perf_engg_cover_cheetah_sm.png">
    <link rel="apple-touch-icon" href="img/ai_sys_perf_engg_cover_cheetah_sm.png">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/python.min.js"></script>
    <style>
        :root {
            --bg-primary: #06060a;
            --bg-secondary: #0c0c14;
            --bg-tertiary: #12121c;
            --bg-card: rgba(16, 16, 24, 0.9);
            --bg-glass: rgba(255, 255, 255, 0.02);
            --border-glass: rgba(255, 255, 255, 0.06);
            --border-highlight: rgba(0, 245, 212, 0.3);
            --accent-primary: #00f5d4;
            --accent-secondary: #9d4edd;
            --accent-tertiary: #f72585;
            --accent-success: #00f5a0;
            --accent-warning: #ffc43d;
            --accent-danger: #ff4757;
            --accent-info: #4cc9f0;
            --text-primary: #ffffff;
            --text-secondary: rgba(255, 255, 255, 0.75);
            --text-muted: rgba(255, 255, 255, 0.45);
            --glow-primary: 0 0 60px rgba(0, 245, 212, 0.2);
            --glow-secondary: 0 0 60px rgba(157, 78, 221, 0.2);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Inter', -apple-system, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
        }

        /* Animated gradient background */
        .bg-gradient {
            position: fixed;
            inset: 0;
            z-index: -2;
            background: 
                radial-gradient(ellipse 80% 50% at 20% 40%, rgba(157, 78, 221, 0.12), transparent),
                radial-gradient(ellipse 60% 60% at 80% 20%, rgba(0, 245, 212, 0.08), transparent),
                radial-gradient(ellipse 50% 80% at 50% 100%, rgba(247, 37, 133, 0.06), transparent);
            animation: gradientShift 30s ease-in-out infinite alternate;
        }

        @keyframes gradientShift {
            0% { filter: hue-rotate(0deg); }
            100% { filter: hue-rotate(30deg); }
        }

        /* Noise texture overlay */
        .noise-overlay {
            position: fixed;
            inset: 0;
            z-index: -1;
            opacity: 0.03;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
        }

        /* Navigation */
        .nav {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            padding: 1rem 2rem;
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: center;
            gap: 0.75rem;
            background: rgba(6, 6, 10, 0.85);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border-glass);
        }

        .nav-brand {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .nav-logo {
            width: 44px;
            height: 44px;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.4rem;
            box-shadow: var(--glow-primary);
        }

        .nav-logo-img {
            width: 48px;
            height: 48px;
            border-radius: 10px;
            object-fit: cover;
            box-shadow: var(--glow-primary);
        }

        .nav-title {
            font-family: 'Inter', -apple-system, sans-serif;
            font-size: 1.1rem;
            font-weight: 600;
            letter-spacing: -0.01em;
            background: linear-gradient(135deg, #fff, var(--accent-primary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .nav-subtitle {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        .nav-tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .nav-tab {
            padding: 0.6rem 1.2rem;
            background: transparent;
            border: 1px solid transparent;
            border-radius: 8px;
            color: var(--text-secondary);
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .nav-tab:hover {
            background: var(--bg-glass);
            color: var(--text-primary);
        }

        .nav-tab.active {
            background: rgba(0, 245, 212, 0.1);
            border-color: var(--accent-primary);
            color: var(--accent-primary);
        }

        .nav-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .gpu-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: rgba(0, 245, 160, 0.1);
            border: 1px solid rgba(0, 245, 160, 0.2);
            border-radius: 20px;
            font-size: 0.8rem;
            color: var(--accent-success);
        }

        .gpu-status.offline {
            background: rgba(255, 196, 61, 0.1);
            border-color: rgba(255, 196, 61, 0.2);
            color: var(--accent-warning);
        }

        .status-pulse {
            width: 8px;
            height: 8px;
            background: currentColor;
            border-radius: 50%;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(0.9); }
        }

        .btn {
            padding: 0.7rem 1.4rem;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: var(--bg-primary);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(0, 245, 212, 0.3);
        }

        /* Main container */
        .main {
            padding: 10rem 2rem 2rem;
            max-width: 1900px;
            margin: 0 auto;
        }

        /* Section headers */
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .section-title {
            font-size: 1.3rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .section-title-icon {
            width: 36px;
            height: 36px;
            background: var(--bg-glass);
            border: 1px solid var(--border-glass);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Hero stats */
        .hero-stats {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .hero-stat {
            background: var(--bg-card);
            border: 1px solid var(--border-glass);
            border-radius: 16px;
            padding: 1.5rem;
            position: relative;
            overflow: hidden;
            transition: all 0.3s;
        }

        .hero-stat:hover {
            border-color: var(--border-highlight);
            transform: translateY(-4px);
        }

        .hero-stat::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
            opacity: 0;
            transition: opacity 0.3s;
        }

        .hero-stat:hover::before { opacity: 1; }

        .hero-stat-value {
            font-size: 2.2rem;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
            background: linear-gradient(135deg, var(--accent-primary), var(--text-primary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .hero-stat-label {
            color: var(--text-muted);
            font-size: 0.85rem;
            margin-top: 0.25rem;
        }

        .hero-stat-change {
            position: absolute;
            top: 1rem;
            right: 1rem;
            font-size: 0.8rem;
            font-weight: 600;
            padding: 0.2rem 0.6rem;
            border-radius: 6px;
        }

        .hero-stat-change.up { color: var(--accent-success); background: rgba(0, 245, 160, 0.1); }
        .hero-stat-change.down { color: var(--accent-danger); background: rgba(255, 71, 87, 0.1); }

        /* Cards */
        .card {
            background: var(--bg-card);
            border: 1px solid var(--border-glass);
            border-radius: 16px;
            overflow: hidden;
        }

        .card-header {
            padding: 1.25rem 1.5rem;
            border-bottom: 1px solid var(--border-glass);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-title {
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .card-body { padding: 1.5rem; }

        .card-actions {
            display: flex;
            gap: 0.5rem;
        }

        .chip {
            padding: 0.4rem 0.8rem;
            background: var(--bg-glass);
            border: 1px solid var(--border-glass);
            border-radius: 6px;
            font-size: 0.8rem;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s;
        }

        .chip:hover, .chip.active {
            background: rgba(0, 245, 212, 0.1);
            border-color: var(--accent-primary);
            color: var(--accent-primary);
        }

        /* Grid layouts */
        .grid-2 { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1.5rem; }
        .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1.5rem; }
        .grid-4 { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1.5rem; }
        .grid-1-2 { display: grid; grid-template-columns: 1fr 2fr; gap: 1.5rem; }
        .grid-2-1 { display: grid; grid-template-columns: 2fr 1fr; gap: 1.5rem; }

        .mb-2 { margin-bottom: 2rem; }
        .mb-3 { margin-bottom: 3rem; }

        /* Chart containers */
        .chart-container {
            position: relative;
            height: 280px;
        }

        .chart-container.tall { height: 350px; }

        /* Benchmark list */
        .benchmark-list {
            max-height: 500px;
            overflow-y: auto;
        }

        .benchmark-item {
            display: grid;
            grid-template-columns: auto 1fr auto auto;
            gap: 1rem;
            align-items: center;
            padding: 1rem;
            border-radius: 10px;
            margin-bottom: 0.5rem;
            background: var(--bg-glass);
            border: 1px solid transparent;
            cursor: pointer;
            transition: all 0.2s;
        }

        .benchmark-item:hover {
            background: rgba(0, 245, 212, 0.03);
            border-color: var(--border-highlight);
        }

        .benchmark-item.selected {
            background: rgba(0, 245, 212, 0.08);
            border-color: var(--accent-primary);
        }

        .benchmark-rank {
            width: 32px;
            height: 32px;
            background: var(--bg-tertiary);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'JetBrains Mono', monospace;
            font-weight: 700;
            font-size: 0.85rem;
        }

        .benchmark-rank.gold { background: linear-gradient(135deg, #ffd700, #ffaa00); color: #000; }
        .benchmark-rank.silver { background: linear-gradient(135deg, #c0c0c0, #a0a0a0); color: #000; }
        .benchmark-rank.bronze { background: linear-gradient(135deg, #cd7f32, #b87333); color: #000; }

        .benchmark-info h4 {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.95rem;
            margin-bottom: 0.25rem;
        }

        .benchmark-meta {
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        .benchmark-bar {
            width: 150px;
            height: 6px;
            background: var(--bg-tertiary);
            border-radius: 3px;
            overflow: hidden;
        }

        .benchmark-bar-fill {
            height: 100%;
            border-radius: 3px;
            transition: width 0.5s ease;
        }

        .benchmark-speedup {
            font-family: 'JetBrains Mono', monospace;
            font-weight: 700;
            font-size: 1.1rem;
            min-width: 80px;
            text-align: right;
        }

        .benchmark-speedup.excellent { color: var(--accent-success); }
        .benchmark-speedup.good { color: var(--accent-primary); }
        .benchmark-speedup.fair { color: var(--accent-warning); }
        .benchmark-speedup.poor { color: var(--accent-danger); }
        .benchmark-speedup.memory { color: var(--accent-info); } /* Memory optimization */

        /* Comparison section */
        .comparison-grid {
            display: grid;
            grid-template-columns: 1fr 80px 1fr;
            gap: 1rem;
            align-items: stretch;
        }

        .comparison-panel {
            background: var(--bg-tertiary);
            border-radius: 12px;
            padding: 1.5rem;
        }

        .comparison-panel.baseline {
            border-left: 3px solid var(--accent-tertiary);
        }

        .comparison-panel.optimized {
            border-left: 3px solid var(--accent-success);
        }

        .comparison-label {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .comparison-label.baseline { color: var(--accent-tertiary); }
        .comparison-label.optimized { color: var(--accent-success); }

        .comparison-arrow {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: var(--text-muted);
        }

        .comparison-arrow-icon {
            font-size: 2rem;
            color: var(--accent-primary);
            animation: arrowPulse 2s ease-in-out infinite;
        }

        @keyframes arrowPulse {
            0%, 100% { transform: translateX(0); opacity: 1; }
            50% { transform: translateX(5px); opacity: 0.7; }
        }

        .comparison-speedup {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent-success);
            margin-top: 0.5rem;
        }

        /* Metrics comparison */
        .metric-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--border-glass);
        }

        .metric-row:last-child { border-bottom: none; }

        .metric-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .metric-values {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .metric-value {
            font-family: 'JetBrains Mono', monospace;
            font-weight: 600;
            padding: 0.3rem 0.6rem;
            border-radius: 6px;
            font-size: 0.85rem;
        }

        .metric-value.baseline {
            background: rgba(247, 37, 133, 0.1);
            color: var(--accent-tertiary);
        }

        .metric-value.optimized {
            background: rgba(0, 245, 160, 0.1);
            color: var(--accent-success);
        }

        .metric-delta {
            font-size: 0.8rem;
            color: var(--accent-success);
        }

        /* Explanation panel */
        .explanation-panel {
            background: linear-gradient(135deg, rgba(157, 78, 221, 0.1), rgba(0, 245, 212, 0.05));
            border: 1px solid rgba(157, 78, 221, 0.2);
            border-radius: 16px;
            padding: 2rem;
        }

        .explanation-header {
            display: flex;
            align-items: flex-start;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .explanation-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--accent-secondary), var(--accent-primary));
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            flex-shrink: 0;
        }

        .explanation-title {
            font-size: 1.4rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .explanation-subtitle {
            color: var(--text-secondary);
            font-size: 0.95rem;
        }

        .explanation-content {
            color: var(--text-secondary);
            font-size: 0.95rem;
            line-height: 1.8;
        }

        .explanation-content h1, .explanation-content h2, .explanation-content h3 {
            color: var(--accent-primary);
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
        }

        .explanation-content h1 { font-size: 1.3rem; }
        .explanation-content h2 { font-size: 1.15rem; }
        .explanation-content h3 { font-size: 1rem; }

        .explanation-content code {
            background: rgba(0, 245, 212, 0.1);
            padding: 0.15rem 0.4rem;
            border-radius: 4px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85em;
        }

        .explanation-content pre {
            background: #0d1117;
            padding: 1rem;
            border-radius: 8px;
            overflow-x: auto;
            margin: 1rem 0;
        }

        .explanation-content pre code {
            background: transparent;
            padding: 0;
        }

        .explanation-content ul, .explanation-content ol {
            margin-left: 1.5rem;
            margin-bottom: 1rem;
        }

        .explanation-content li {
            margin-bottom: 0.5rem;
        }

        .explanation-content strong {
            color: var(--text-primary);
        }

        /* Loading state */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 3rem;
            color: var(--text-muted);
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--border-glass);
            border-top-color: var(--accent-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 1rem;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* No data state */
        .no-data {
            text-align: center;
            padding: 3rem;
            color: var(--text-muted);
        }

        .no-data-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        /* Roofline legend */
        .roofline-legend {
            display: flex;
            gap: 2rem;
            justify-content: center;
            margin-top: 1rem;
        }

        .roofline-legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .roofline-legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: var(--bg-secondary); }
        ::-webkit-scrollbar-thumb { background: var(--border-glass); border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--text-muted); }

        /* Select dropdown styling */
        #compareSelect {
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }
        #compareSelect:hover {
            border-color: var(--accent-success);
            box-shadow: 0 0 0 3px rgba(0, 245, 160, 0.15);
        }
        #compareSelect:focus {
            outline: none;
            border-color: var(--accent-success);
            box-shadow: 0 0 0 3px rgba(0, 245, 160, 0.25);
        }
        #compareSelect option {
            background: #1a1a2e;
            color: #ffffff;
            padding: 12px;
        }
        #compareSelect option:hover,
        #compareSelect option:checked {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
        }

        /* Responsive */
        @media (max-width: 1400px) {
            .hero-stats { grid-template-columns: repeat(3, 1fr); }
            .grid-3 { grid-template-columns: repeat(2, 1fr); }
            .main { padding-top: 12rem; }
        }

        @media (max-width: 900px) {
            .hero-stats { grid-template-columns: repeat(2, 1fr); }
            .grid-2, .grid-2-1, .grid-1-2 { grid-template-columns: 1fr; }
            .comparison-grid { grid-template-columns: 1fr; }
            .comparison-arrow { transform: rotate(90deg); padding: 1rem 0; }
            .main { padding-top: 16rem; }
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .animate { animation: fadeIn 0.5s ease-out forwards; }
        .delay-1 { animation-delay: 0.1s; opacity: 0; }
        .delay-2 { animation-delay: 0.2s; opacity: 0; }
        .delay-3 { animation-delay: 0.3s; opacity: 0; }
        .delay-4 { animation-delay: 0.4s; opacity: 0; }
        .delay-5 { animation-delay: 0.5s; opacity: 0; }

        /* Tab content */
        .tab-content { display: none; }
        .tab-content.active { display: block; }

        /* Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal-overlay.active { display: flex; }

        .modal {
            background: var(--bg-card);
            border: 1px solid var(--border-glass);
            border-radius: 20px;
            max-width: 900px;
            width: 90%;
            max-height: 85vh;
            overflow: hidden;
        }

        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-glass);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-close {
            width: 36px;
            height: 36px;
            background: var(--bg-glass);
            border: 1px solid var(--border-glass);
            border-radius: 10px;
            color: var(--text-secondary);
            font-size: 1.2rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .modal-close:hover {
            background: rgba(255, 71, 87, 0.1);
            border-color: var(--accent-danger);
            color: var(--accent-danger);
        }

        .modal-body {
            padding: 1.5rem;
            max-height: calc(85vh - 100px);
            overflow-y: auto;
        }

        /* Analysis card */
        .analysis-card {
            background: var(--bg-glass);
            border: 1px solid var(--border-glass);
            border-radius: 12px;
            padding: 1.25rem;
            margin-bottom: 1rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .analysis-card:hover {
            border-color: var(--border-highlight);
            background: rgba(0, 245, 212, 0.03);
        }

        .analysis-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .analysis-card-title {
            font-family: 'JetBrains Mono', monospace;
            font-weight: 600;
        }

        .analysis-card-chapter {
            font-size: 0.8rem;
            color: var(--accent-primary);
            background: rgba(0, 245, 212, 0.1);
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
        }

        .analysis-card-preview {
            font-size: 0.85rem;
            color: var(--text-muted);
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }
    </style>
</head>
<body>
    <div class="bg-gradient"></div>
    <div class="noise-overlay"></div>

    <!-- Navigation -->
    <nav class="nav">
        <div class="nav-brand">
            <img src="img/ai_sys_perf_engg_cover_cheetah_sm.png" alt="AI Systems Performance" class="nav-logo-img" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
            <div class="nav-logo" style="display: none;">‚ö°</div>
            <div>
                <div class="nav-title">AI Systems Performance</div>
                <div class="nav-subtitle">Optimization Dashboard</div>
            </div>
        </div>
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('overview')">üìà Overview</button>
            <button class="nav-tab" onclick="showTab('compare')">‚öñÔ∏è Compare</button>
            <button class="nav-tab" onclick="showTab('insights')">üß† LLM Insights</button>
            <button class="nav-tab" onclick="showTab('roofline')">üìê Roofline</button>
            <button class="nav-tab" onclick="showTab('profiler')">üî• Profiler</button>
            <button class="nav-tab" onclick="showTab('memory')">üíæ Memory</button>
            <button class="nav-tab" onclick="showTab('compile')">‚ö° Compile</button>
            <button class="nav-tab" onclick="showTab('deepprofile')" style="background: linear-gradient(135deg, rgba(157, 78, 221, 0.1), rgba(0, 245, 212, 0.1));">üî¨ Deep Profile</button>
            <button class="nav-tab" onclick="showTab('liveopt')" style="background: linear-gradient(135deg, rgba(247, 37, 133, 0.1), rgba(255, 196, 61, 0.1));">üöÄ Live Optimizer</button>
            <button class="nav-tab" onclick="showTab('analysis')" style="background: linear-gradient(135deg, rgba(0, 245, 160, 0.1), rgba(76, 201, 240, 0.1));">üìä Analysis</button>
        </div>
        <div class="nav-actions">
            <div class="gpu-status" id="gpuStatus">
                <div class="status-pulse"></div>
                <span id="gpuStatusText">Loading...</span>
            </div>
            <div class="dropdown" style="position: relative;">
                <button class="btn btn-secondary" onclick="toggleExportMenu()" style="background: var(--bg-glass); border-color: var(--border-glass);">
                    <span>üìä</span> Export
                </button>
                <div id="exportMenu" class="dropdown-menu" style="display: none; position: absolute; top: 100%; right: 0; margin-top: 0.5rem; background: var(--bg-card); border: 1px solid var(--border-glass); border-radius: 8px; padding: 0.5rem; min-width: 150px; z-index: 1000;">
                    <button onclick="exportPDF()" style="display: block; width: 100%; padding: 0.5rem 1rem; background: none; border: none; color: var(--text-primary); text-align: left; cursor: pointer; border-radius: 4px;">üìï PDF Report</button>
                    <button onclick="exportHTMLReport()" style="display: block; width: 100%; padding: 0.5rem 1rem; background: none; border: none; color: var(--text-primary); text-align: left; cursor: pointer; border-radius: 4px;">üåê HTML Report</button>
                    <hr style="border: none; border-top: 1px solid var(--border-glass); margin: 0.5rem 0;">
                    <button onclick="exportCSV()" style="display: block; width: 100%; padding: 0.5rem 1rem; background: none; border: none; color: var(--text-primary); text-align: left; cursor: pointer; border-radius: 4px;">üìÑ CSV (Basic)</button>
                    <button onclick="exportDetailedCSV()" style="display: block; width: 100%; padding: 0.5rem 1rem; background: none; border: none; color: var(--text-primary); text-align: left; cursor: pointer; border-radius: 4px;">üìã CSV (Detailed)</button>
                    <button onclick="exportJSON()" style="display: block; width: 100%; padding: 0.5rem 1rem; background: none; border: none; color: var(--text-primary); text-align: left; cursor: pointer; border-radius: 4px;">üì¶ JSON</button>
                </div>
            </div>
            <button class="btn btn-primary" onclick="refreshData()">
                <span>üîÑ</span> Refresh
            </button>
        </div>
    </nav>

    <main class="main">
        <!-- Overview Tab -->
        <div id="tab-overview" class="tab-content active">
            <div class="section-header">
                <h2 class="section-title">
                    <div class="section-title-icon">üìä</div>
                    Performance Overview
                </h2>
                <div id="dataTimestamp" style="font-size: 0.85rem; color: var(--text-muted);"></div>
            </div>

            <!-- Hero Stats -->
            <div class="hero-stats mb-2" id="heroStats">
                <div class="hero-stat animate delay-1">
                    <div class="hero-stat-value" id="statTotal">-</div>
                    <div class="hero-stat-label">Total Benchmarks</div>
                </div>
                <div class="hero-stat animate delay-2">
                    <div class="hero-stat-value" id="statBest">-</div>
                    <div class="hero-stat-label">Best Speedup</div>
                </div>
                <div class="hero-stat animate delay-3">
                    <div class="hero-stat-value" id="statAvg">-</div>
                    <div class="hero-stat-label">Average Speedup</div>
                </div>
                <div class="hero-stat animate delay-4">
                    <div class="hero-stat-value" id="statSuccess">-</div>
                    <div class="hero-stat-label">Successful</div>
                </div>
                <div class="hero-stat animate delay-5">
                    <div class="hero-stat-value" id="statMemoryOpts">-</div>
                    <div class="hero-stat-label">üíæ Memory Opts</div>
                </div>
                <div class="hero-stat animate delay-6">
                    <div class="hero-stat-value" id="statBestMemorySavings">-</div>
                    <div class="hero-stat-label">Best Mem Save</div>
                </div>
                <div class="hero-stat animate delay-6">
                    <div class="hero-stat-value" id="statFailed">-</div>
                    <div class="hero-stat-label">Failed/Regressed</div>
                </div>
            </div>

            <!-- Main charts row -->
            <div class="grid-2-1 mb-3">
                <div class="card animate delay-2">
                    <div class="card-header">
                        <h3 class="card-title">üìà Speedup by Benchmark</h3>
                        <div class="card-actions">
                            <button class="chip active" onclick="filterChart('all')">All</button>
                            <button class="chip" onclick="filterChart('python')">Python</button>
                            <button class="chip" onclick="filterChart('cuda')">CUDA</button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="chart-container tall">
                            <canvas id="speedupChart"></canvas>
                        </div>
                    </div>
                </div>

                <div class="card animate delay-3">
                    <div class="card-header">
                        <h3 class="card-title">üéØ Benchmark Status</h3>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="statusChart"></canvas>
                        </div>
                        <div id="statusLegend" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin-top: 1.5rem; text-align: center;">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Benchmark leaderboard -->
            <div class="card animate delay-4 mb-3">
                <div class="card-header">
                    <h3 class="card-title">üèÜ Optimization Leaderboard</h3>
                </div>
                <div class="card-body">
                    <div class="benchmark-list" id="benchmarkList">
                        <div class="loading">
                            <div class="loading-spinner"></div>
                            <span>Loading benchmark data...</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Compare Tab -->
        <div id="tab-compare" class="tab-content">
            <div class="section-header">
                <h2 class="section-title">
                    <div class="section-title-icon">‚öñÔ∏è</div>
                    Baseline vs Optimized Comparison
                </h2>
                <select id="compareSelect" onchange="updateComparison()" style="padding: 0.75rem 2.5rem 0.75rem 1rem; background: var(--bg-card); border: 2px solid var(--accent-primary); border-radius: 8px; color: var(--text-primary); font-size: 0.95rem; cursor: pointer; min-width: 320px; appearance: none; -webkit-appearance: none; background-image: url('data:image/svg+xml;charset=US-ASCII,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"%2300f5a0\" stroke-width=\"2\"><polyline points=\"6 9 12 15 18 9\"></polyline></svg>'); background-repeat: no-repeat; background-position: right 0.75rem center; font-weight: 500;">
                    <option value="">Loading benchmarks...</option>
                </select>
            </div>

            <!-- Comparison display -->
            <div id="comparisonContent">
                <div class="no-data">
                    <div class="no-data-icon">üìä</div>
                    <p>Select a benchmark above to compare baseline vs optimized performance</p>
                </div>
            </div>
        </div>

        <!-- LLM Insights Tab -->
        <div id="tab-insights" class="tab-content">
            <div class="section-header">
                <h2 class="section-title">
                    <div class="section-title-icon">üß†</div>
                    LLM-Generated Insights & Explanations
                </h2>
            </div>

            <div id="insightsContent">
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <span>Loading LLM analysis...</span>
                </div>
            </div>
        </div>

        <!-- Roofline Tab -->
        <div id="tab-roofline" class="tab-content">
            <div class="section-header">
                <h2 class="section-title">
                    <div class="section-title-icon">üìê</div>
                    Roofline Analysis
                </h2>
            </div>

            <div class="grid-2 mb-3">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Roofline Model - NVIDIA B200</h3>
                    </div>
                    <div class="card-body">
                        <div class="chart-container tall">
                            <canvas id="rooflineChart"></canvas>
                        </div>
                        <div class="roofline-legend">
                            <div class="roofline-legend-item">
                                <div class="roofline-legend-dot" style="background: var(--accent-tertiary);"></div>
                                <span>Baseline</span>
                            </div>
                            <div class="roofline-legend-item">
                                <div class="roofline-legend-dot" style="background: var(--accent-success);"></div>
                                <span>Optimized</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Performance Distribution</h3>
                    </div>
                    <div class="card-body">
                        <div class="chart-container tall">
                            <canvas id="distributionChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Architecture specs -->
            <div class="card mb-3">
                <div class="card-header">
                    <h3 class="card-title">üñ•Ô∏è GPU Architecture Specifications</h3>
                </div>
                <div class="card-body">
                    <div id="gpuSpecs" style="display: grid; grid-template-columns: repeat(6, 1fr); gap: 2rem; text-align: center;">
                        <!-- Populated dynamically -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Profiler Tab -->
        <div id="tab-profiler" class="tab-content">
            <div class="section-header">
                <h2 class="section-title">
                    <div class="section-title-icon">üî•</div>
                    GPU Flame Graph & Kernel Analysis
                </h2>
            </div>

            <div class="grid-2 mb-3">
                <!-- Flame Graph -->
                <div class="card" style="grid-column: 1 / -1;">
                    <div class="card-header">
                        <h3 class="card-title">GPU Flame Graph</h3>
                        <span class="badge badge-info">Interactive</span>
                    </div>
                    <div class="card-body">
                        <div id="flameGraphContainer" style="height: 400px; background: var(--bg-tertiary); border-radius: 8px; position: relative; overflow: hidden;">
                            <div id="flameGraph" style="width: 100%; height: 100%;"></div>
                            <div id="flameTooltip" style="display: none; position: absolute; background: var(--bg-card); border: 1px solid var(--border-glass); padding: 8px 12px; border-radius: 6px; font-size: 12px; pointer-events: none; z-index: 100;"></div>
                        </div>
                        <p class="hint mt-2" style="color: var(--text-muted); font-size: 12px;">üí° Hover over bars to see kernel details. Wider bars = more time spent. Click to zoom in.</p>
                    </div>
                </div>
            </div>

            <div class="grid-2 mb-3">
                <!-- Top Kernels Table -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Top Kernels by Time</h3>
                    </div>
                    <div class="card-body">
                        <div id="topKernelsTable" style="max-height: 400px; overflow-y: auto;">
                            <table style="width: 100%; border-collapse: collapse;">
                                <thead>
                                    <tr style="border-bottom: 1px solid var(--border-glass);">
                                        <th style="text-align: left; padding: 0.75rem; color: var(--text-muted);">Kernel</th>
                                        <th style="text-align: right; padding: 0.75rem; color: var(--text-muted);">Time (Œºs)</th>
                                        <th style="text-align: right; padding: 0.75rem; color: var(--text-muted);">%</th>
                                    </tr>
                                </thead>
                                <tbody id="kernelTableBody">
                                    <!-- Populated dynamically -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Kernel Categories -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Kernel Categories</h3>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="kernelCategoryChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- CPU/GPU Timeline -->
            <div class="card mb-3">
                <div class="card-header">
                    <h3 class="card-title">‚è±Ô∏è CPU/GPU Timeline</h3>
                </div>
                <div class="card-body">
                    <div id="timelineContainer" style="height: 200px; background: var(--bg-tertiary); border-radius: 8px; position: relative; overflow: hidden; padding: 20px;">
                        <div style="position: absolute; left: 20px; top: 40px; font-size: 12px; color: var(--text-muted);">CPU</div>
                        <div style="position: absolute; left: 20px; top: 120px; font-size: 12px; color: var(--text-muted);">GPU</div>
                        <div id="cpuTrack" style="position: absolute; left: 60px; right: 20px; top: 30px; height: 40px; background: rgba(59, 130, 246, 0.1); border-radius: 4px;"></div>
                        <div id="gpuTrack" style="position: absolute; left: 60px; right: 20px; top: 110px; height: 40px; background: rgba(34, 197, 94, 0.1); border-radius: 4px;"></div>
                    </div>
                    <div class="timeline-stats mt-2" style="display: flex; gap: 2rem; padding-top: 1rem;">
                        <div><span style="color: var(--text-muted);">Total Time:</span> <span id="timelineTotal" style="color: var(--accent-primary);">-</span></div>
                        <div><span style="color: var(--text-muted);">CPU Active:</span> <span id="timelineCPU" style="color: #3b82f6;">-</span></div>
                        <div><span style="color: var(--text-muted);">GPU Active:</span> <span id="timelineGPU" style="color: #22c55e;">-</span></div>
                        <div><span style="color: var(--text-muted);">Overlap:</span> <span id="timelineOverlap" style="color: var(--accent-secondary);">-</span></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Memory Tab -->
        <div id="tab-memory" class="tab-content">
            <div class="section-header">
                <h2 class="section-title">
                    <div class="section-title-icon">üíæ</div>
                    Memory Analysis
                </h2>
            </div>

            <div class="hero-stats mb-3">
                <div class="hero-stat animate">
                    <div class="hero-stat-value" id="memPeak">-</div>
                    <div class="hero-stat-label">Peak Memory</div>
                </div>
                <div class="hero-stat animate">
                    <div class="hero-stat-value" id="memAllocated">-</div>
                    <div class="hero-stat-label">Allocated</div>
                </div>
                <div class="hero-stat animate">
                    <div class="hero-stat-value" id="memReserved">-</div>
                    <div class="hero-stat-label">Reserved</div>
                </div>
                <div class="hero-stat animate">
                    <div class="hero-stat-value" id="memEfficiency">-</div>
                    <div class="hero-stat-label">Efficiency</div>
                </div>
            </div>

            <div class="grid-2 mb-3">
                <!-- Memory Timeline -->
                <div class="card" style="grid-column: 1 / -1;">
                    <div class="card-header">
                        <h3 class="card-title">Memory Usage Over Time</h3>
                    </div>
                    <div class="card-body">
                        <div class="chart-container tall">
                            <canvas id="memoryTimelineChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <div class="grid-2 mb-3">
                <!-- Memory Breakdown -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Memory Breakdown</h3>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="memoryBreakdownChart"></canvas>
                        </div>
                        <div id="memoryBreakdownLegend" class="mt-2" style="display: flex; flex-wrap: wrap; gap: 1rem; justify-content: center;">
                            <!-- Populated dynamically -->
                        </div>
                    </div>
                </div>

                <!-- Memory Allocations -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Allocation Patterns</h3>
                    </div>
                    <div class="card-body">
                        <div id="allocationPatterns" style="display: flex; flex-direction: column; gap: 1rem;">
                            <div class="allocation-bar">
                                <div class="allocation-label" style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                                    <span>Activations</span>
                                    <span id="allocActivations">-</span>
                                </div>
                                <div style="background: var(--bg-tertiary); border-radius: 4px; height: 8px; overflow: hidden;">
                                    <div id="allocActivationsBar" style="height: 100%; background: linear-gradient(90deg, #22c55e, #4ade80); width: 0%; transition: width 0.5s;"></div>
                                </div>
                            </div>
                            <div class="allocation-bar">
                                <div class="allocation-label" style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                                    <span>Weights</span>
                                    <span id="allocWeights">-</span>
                                </div>
                                <div style="background: var(--bg-tertiary); border-radius: 4px; height: 8px; overflow: hidden;">
                                    <div id="allocWeightsBar" style="height: 100%; background: linear-gradient(90deg, #3b82f6, #60a5fa); width: 0%; transition: width 0.5s;"></div>
                                </div>
                            </div>
                            <div class="allocation-bar">
                                <div class="allocation-label" style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                                    <span>Gradients</span>
                                    <span id="allocGradients">-</span>
                                </div>
                                <div style="background: var(--bg-tertiary); border-radius: 4px; height: 8px; overflow: hidden;">
                                    <div id="allocGradientsBar" style="height: 100%; background: linear-gradient(90deg, #a855f7, #c084fc); width: 0%; transition: width 0.5s;"></div>
                                </div>
                            </div>
                            <div class="allocation-bar">
                                <div class="allocation-label" style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                                    <span>Optimizer State</span>
                                    <span id="allocOptimizer">-</span>
                                </div>
                                <div style="background: var(--bg-tertiary); border-radius: 4px; height: 8px; overflow: hidden;">
                                    <div id="allocOptimizerBar" style="height: 100%; background: linear-gradient(90deg, #f59e0b, #fbbf24); width: 0%; transition: width 0.5s;"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Compile Tab -->
        <div id="tab-compile" class="tab-content">
            <div class="section-header">
                <h2 class="section-title">
                    <div class="section-title-icon">‚ö°</div>
                    torch.compile Analysis
                </h2>
            </div>

            <div class="hero-stats mb-3">
                <div class="hero-stat animate">
                    <div class="hero-stat-value" id="compileSpeedup" style="color: var(--accent-success);">-</div>
                    <div class="hero-stat-label">Speedup</div>
                </div>
                <div class="hero-stat animate">
                    <div class="hero-stat-value" id="compileTime">-</div>
                    <div class="hero-stat-label">Compile Time</div>
                </div>
                <div class="hero-stat animate">
                    <div class="hero-stat-value" id="graphBreaks">-</div>
                    <div class="hero-stat-label">Graph Breaks</div>
                </div>
                <div class="hero-stat animate">
                    <div class="hero-stat-value" id="fusionRatio">-</div>
                    <div class="hero-stat-label">Fusion Ratio</div>
                </div>
            </div>

            <div class="grid-2 mb-3">
                <!-- Compile Mode Comparison -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Mode Comparison</h3>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="compileModeChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Eager vs Compiled -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Eager vs Compiled</h3>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="eagerVsCompiledChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <div class="grid-2 mb-3">
                <!-- Graph Breaks -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">‚ö†Ô∏è Graph Breaks</h3>
                    </div>
                    <div class="card-body">
                        <div id="graphBreaksList" style="max-height: 300px; overflow-y: auto;">
                            <!-- Populated dynamically -->
                        </div>
                    </div>
                </div>

                <!-- Recommendations -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">üí° Recommendations</h3>
                    </div>
                    <div class="card-body">
                        <div id="compileRecommendations" style="display: flex; flex-direction: column; gap: 1rem;">
                            <!-- Populated dynamically -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Fusion Visualization -->
            <div class="card mb-3">
                <div class="card-header">
                    <h3 class="card-title">üîÄ Operation Fusion</h3>
                </div>
                <div class="card-body">
                    <div style="display: flex; align-items: center; justify-content: center; gap: 2rem; padding: 2rem;">
                        <div style="text-align: center;">
                            <div style="font-size: 48px; font-weight: bold; color: var(--accent-tertiary);" id="opsBefore">-</div>
                            <div style="color: var(--text-muted);">Ops Before</div>
                        </div>
                        <div style="font-size: 32px; color: var(--text-muted);">‚Üí</div>
                        <div style="text-align: center;">
                            <div style="font-size: 48px; font-weight: bold; color: var(--accent-success);" id="opsAfter">-</div>
                            <div style="color: var(--text-muted);">Ops After</div>
                        </div>
                        <div style="font-size: 32px; color: var(--text-muted);">=</div>
                        <div style="text-align: center;">
                            <div style="font-size: 48px; font-weight: bold; color: var(--accent-primary);" id="fusionResult">-</div>
                            <div style="color: var(--text-muted);">Reduction</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Deep Profile Tab (NEW!) -->
        <div id="tab-deepprofile" class="tab-content">
            <div class="section-header" style="position: relative; z-index: 10;">
                <h2 class="section-title">
                    <div class="section-title-icon">üî¨</div>
                    Deep Profile Comparison
                </h2>
            </div>

            <!-- Chapter Selector Card -->
            <div class="card mb-3" style="position: relative; z-index: 100;">
                <div class="card-body" style="display: flex; align-items: center; gap: 1.5rem; flex-wrap: wrap;">
                    <div style="display: flex; align-items: center; gap: 0.75rem;">
                        <span style="color: var(--text-muted); font-weight: 500;">Select Profile:</span>
                        <select id="profileChapterSelect" onchange="loadProfileComparison()" style="padding: 0.75rem 2.5rem 0.75rem 1rem; background: var(--bg-tertiary); border: 2px solid var(--accent-secondary); border-radius: 8px; color: var(--text-primary); font-size: 0.95rem; cursor: pointer; min-width: 320px; appearance: none; background-image: url('data:image/svg+xml;charset=US-ASCII,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"%239d4edd\" stroke-width=\"2\"><polyline points=\"6 9 12 15 18 9\"></polyline></svg>'); background-repeat: no-repeat; background-position: right 0.75rem center; font-weight: 500;">
                            <option value="">Loading profiles...</option>
                        </select>
                    </div>
                    <div style="display: flex; gap: 1rem; align-items: center; margin-left: auto;">
                        <div style="text-align: center; padding: 0 1rem;">
                            <div style="font-size: 1.5rem; font-weight: 700; color: var(--accent-success);" id="profileSpeedup">-</div>
                            <div style="font-size: 0.75rem; color: var(--text-muted);">Speedup</div>
                        </div>
                        <div style="text-align: center; padding: 0 1rem; border-left: 1px solid var(--border-glass);">
                            <div style="font-size: 1.5rem; font-weight: 700; color: var(--accent-primary);" id="profileTimeSaved">-</div>
                            <div style="font-size: 0.75rem; color: var(--text-muted);">Time Saved (ms)</div>
                        </div>
                        <div style="text-align: center; padding: 0 1rem; border-left: 1px solid var(--border-glass);">
                            <div style="font-size: 1.2rem; font-weight: 600; color: var(--accent-warning);" id="profileBindingShift">-</div>
                            <div style="font-size: 0.75rem; color: var(--text-muted);">Binding Shift</div>
                        </div>
                        <div style="text-align: center; padding: 0 1rem; border-left: 1px solid var(--border-glass);">
                            <div style="font-size: 1.5rem; font-weight: 700; color: var(--accent-info);" id="profilePairs">-</div>
                            <div style="font-size: 0.75rem; color: var(--text-muted);">Profiles</div>
                        </div>
                    </div>
                </div>
            </div>


            <!-- Why Faster Section -->
            <div class="card mb-3" id="whyFasterCard" style="display: none;">
                <div class="card-header" style="background: linear-gradient(90deg, rgba(0, 245, 160, 0.1), transparent);">
                    <h3 class="card-title">‚ú® Why Is It Faster?</h3>
                </div>
                <div class="card-body" id="whyFasterContent">
                    <!-- Populated dynamically -->
                </div>
            </div>

            <div class="grid-2 mb-3">
                <!-- nsys Metrics Comparison -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">üìä nsys Metrics Comparison</h3>
                        <span class="badge badge-info" style="background: rgba(76, 201, 240, 0.2); color: var(--accent-info); padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.7rem;">System-wide</span>
                    </div>
                    <div class="card-body">
                        <div id="nsysComparison" style="max-height: 400px; overflow-y: auto;">
                            <div class="no-data" style="padding: 2rem; text-align: center;">
                                <div class="no-data-icon">üìä</div>
                                <p style="color: var(--text-muted);">Select a chapter with profiles to compare nsys metrics</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ncu Metrics Comparison -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">üî• ncu Metrics Comparison</h3>
                        <span class="badge badge-info" style="background: rgba(247, 37, 133, 0.2); color: var(--accent-tertiary); padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.7rem;">Kernel-level</span>
                    </div>
                    <div class="card-body">
                        <div id="ncuComparison" style="max-height: 400px; overflow-y: auto;">
                            <div class="no-data" style="padding: 2rem; text-align: center;">
                                <div class="no-data-icon">üî•</div>
                                <p style="color: var(--text-muted);">Select a chapter with profiles to compare ncu metrics</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Improvement Attribution -->
            <div class="grid-2 mb-3">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">üìà Improvement Attribution</h3>
                    </div>
                    <div class="card-body">
                        <div class="chart-container" style="height: 250px;">
                            <canvas id="attributionChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Remaining Bottlenecks & Recommendations -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">üéØ Recommendations</h3>
                    </div>
                    <div class="card-body">
                        <div id="profileRecommendations" style="display: flex; flex-direction: column; gap: 0.75rem;">
                            <div style="padding: 1rem; background: var(--bg-glass); border-radius: 8px; border-left: 3px solid var(--accent-info);">
                                <span style="color: var(--text-muted);">Run benchmarks with --profile deep_dive to get detailed recommendations</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Kernel-Level Speedup Breakdown -->
            <div class="card mb-3">
                <div class="card-header">
                    <h3 class="card-title">‚ö° Kernel-Level Speedup Breakdown</h3>
                </div>
                <div class="card-body">
                    <div id="kernelSpeedupTable" style="max-height: 350px; overflow-y: auto;">
                        <table style="width: 100%; border-collapse: collapse;">
                            <thead>
                                <tr style="border-bottom: 1px solid var(--border-glass);">
                                    <th style="text-align: left; padding: 0.75rem; color: var(--text-muted);">Kernel</th>
                                    <th style="text-align: right; padding: 0.75rem; color: var(--text-muted);">Baseline (ms)</th>
                                    <th style="text-align: right; padding: 0.75rem; color: var(--text-muted);">Optimized (ms)</th>
                                    <th style="text-align: right; padding: 0.75rem; color: var(--text-muted);">Speedup</th>
                                    <th style="text-align: center; padding: 0.75rem; color: var(--text-muted);">Binding</th>
                                    <th style="text-align: left; padding: 0.75rem; color: var(--text-muted);">Primary Improvement</th>
                                </tr>
                            </thead>
                            <tbody id="kernelSpeedupBody">
                                <tr>
                                    <td colspan="6" style="text-align: center; padding: 2rem; color: var(--text-muted);">
                                        Select a chapter to view kernel-level analysis
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Live Optimizer Tab (NEW!) -->
        <div id="tab-liveopt" class="tab-content">
            <div class="section-header">
                <h2 class="section-title">
                    <div class="section-title-icon">üöÄ</div>
                    Live Optimization Console
                </h2>
                <div style="display: flex; gap: 1rem; align-items: center;">
                    <select id="optimizeTarget" style="padding: 0.75rem 1.5rem 0.75rem 1rem; background: var(--bg-card); border: 2px solid var(--accent-tertiary); border-radius: 8px; color: var(--text-primary); font-size: 0.95rem; cursor: pointer; min-width: 280px;">
                        <option value="">Select target...</option>
                    </select>
                    <button id="startOptBtn" class="btn btn-primary" onclick="startOptimization()" style="background: linear-gradient(135deg, var(--accent-tertiary), var(--accent-secondary));">
                        <span>üöÄ</span> Start Optimization
                    </button>
                    <button id="stopOptBtn" class="btn" onclick="stopOptimization()" style="display: none; background: var(--accent-danger);">
                        <span>‚èπÔ∏è</span> Stop
                    </button>
                </div>
            </div>

            <!-- Optimization Options -->
            <div class="card mb-3">
                <div class="card-header">
                    <h3 class="card-title">‚öôÔ∏è Optimization Options</h3>
                </div>
                <div class="card-body" style="display: flex; gap: 2rem; flex-wrap: wrap;">
                    <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                        <input type="checkbox" id="optLLM" checked style="width: 18px; height: 18px; accent-color: var(--accent-primary);">
                        <span>üß† LLM Analysis</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                        <input type="checkbox" id="optPatches" checked style="width: 18px; height: 18px; accent-color: var(--accent-primary);">
                        <span>üîß Apply Patches</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                        <input type="checkbox" id="optRebench" checked style="width: 18px; height: 18px; accent-color: var(--accent-primary);">
                        <span>‚è±Ô∏è Rebenchmark</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                        <input type="checkbox" id="optExplain" style="width: 18px; height: 18px; accent-color: var(--accent-primary);">
                        <span>üìñ Generate Explanations</span>
                    </label>
                </div>
            </div>

            <!-- Status Bar -->
            <div class="hero-stats mb-3" style="grid-template-columns: repeat(4, 1fr);">
                <div class="hero-stat">
                    <div class="hero-stat-value" id="optStatus" style="font-size: 1.2rem;">‚è∏Ô∏è Idle</div>
                    <div class="hero-stat-label">Status</div>
                </div>
                <div class="hero-stat">
                    <div class="hero-stat-value" id="optDuration">-</div>
                    <div class="hero-stat-label">Duration</div>
                </div>
                <div class="hero-stat">
                    <div class="hero-stat-value" id="optEvents">0</div>
                    <div class="hero-stat-label">Events</div>
                </div>
                <div class="hero-stat">
                    <div class="hero-stat-value" id="optSpeedup">-</div>
                    <div class="hero-stat-label">Best Speedup</div>
                </div>
            </div>

            <!-- Live Console -->
            <div class="card mb-3">
                <div class="card-header" style="background: linear-gradient(90deg, rgba(6, 6, 10, 0.95), var(--bg-card));">
                    <h3 class="card-title">üì∫ Live Console</h3>
                    <div style="display: flex; gap: 0.5rem;">
                        <button class="chip" onclick="filterConsole('all')">All</button>
                        <button class="chip" onclick="filterConsole('llm')">üß† LLM</button>
                        <button class="chip" onclick="filterConsole('patch')">üîß Patches</button>
                        <button class="chip" onclick="filterConsole('benchmark')">üìä Benchmarks</button>
                        <button class="chip" onclick="clearConsole()">üóëÔ∏è Clear</button>
                    </div>
                </div>
                <div class="card-body" style="padding: 0;">
                    <div id="liveConsole" style="height: 500px; overflow-y: auto; background: #0a0a12; font-family: 'JetBrains Mono', monospace; font-size: 13px; padding: 1rem; border-radius: 0 0 16px 16px;">
                        <div class="console-welcome" style="color: var(--text-muted); padding: 2rem; text-align: center;">
                            <div style="font-size: 48px; margin-bottom: 1rem;">üöÄ</div>
                            <div style="font-size: 1.1rem; margin-bottom: 0.5rem;">Ready to optimize!</div>
                            <div style="font-size: 0.9rem;">Select a target and click "Start Optimization" to begin</div>
                            <div style="margin-top: 1rem; font-size: 0.8rem; color: var(--accent-primary);">
                                Watch LLM analysis, patch generation, and benchmarks stream in real-time
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- LLM Request/Response Viewer -->
            <div class="grid-2 mb-3">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">üß† Latest LLM Request</h3>
                    </div>
                    <div class="card-body">
                        <div id="llmRequest" style="max-height: 300px; overflow-y: auto; background: var(--bg-tertiary); border-radius: 8px; padding: 1rem; font-family: 'JetBrains Mono', monospace; font-size: 12px; color: var(--text-secondary);">
                            <span style="color: var(--text-muted);">LLM requests will appear here during optimization...</span>
                        </div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">‚ú® Generated Patches</h3>
                    </div>
                    <div class="card-body">
                        <div id="generatedPatches" style="max-height: 300px; overflow-y: auto; display: flex; flex-direction: column; gap: 0.5rem;">
                            <div style="padding: 1rem; background: var(--bg-glass); border-radius: 8px; color: var(--text-muted); text-align: center;">
                                Generated patches will appear here...
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Analysis Tab -->
        <div id="tab-analysis" class="tab-content">
            <div class="section-header animate">
                <h2 class="section-title">
                    <span class="section-icon">üìä</span>
                    Multi-Metric Analysis
                </h2>
                <p class="section-subtitle">Analyze trade-offs, find Pareto-optimal solutions, and get recommendations</p>
            </div>

            <div class="grid-3 mb-3">
                <!-- Speed Leaderboard -->
                <div class="card animate delay-1">
                    <div class="card-header">
                        <h3 class="card-title">üöÄ Speed Champions</h3>
                    </div>
                    <div class="card-body">
                        <div id="speedLeaderboard" style="display: flex; flex-direction: column; gap: 0.5rem;">
                            <div style="color: var(--text-muted); text-align: center;">Loading...</div>
                        </div>
                    </div>
                </div>

                <!-- Memory Leaderboard -->
                <div class="card animate delay-2">
                    <div class="card-header">
                        <h3 class="card-title">üíæ Memory Champions</h3>
                    </div>
                    <div class="card-body">
                        <div id="memoryLeaderboard" style="display: flex; flex-direction: column; gap: 0.5rem;">
                            <div style="color: var(--text-muted); text-align: center;">Loading...</div>
                        </div>
                    </div>
                </div>

                <!-- Balanced/Pareto -->
                <div class="card animate delay-3">
                    <div class="card-header">
                        <h3 class="card-title">‚≠ê Pareto Optimal</h3>
                    </div>
                    <div class="card-body">
                        <div id="paretoLeaderboard" style="display: flex; flex-direction: column; gap: 0.5rem;">
                            <div style="color: var(--text-muted); text-align: center;">Loading...</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="grid-2 mb-3">
                <!-- Trade-off Chart -->
                <div class="card animate delay-2">
                    <div class="card-header">
                        <h3 class="card-title">üìà Speed vs Memory Trade-offs</h3>
                    </div>
                    <div class="card-body">
                        <div class="chart-container tall">
                            <canvas id="tradeoffChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Recommendations -->
                <div class="card animate delay-3">
                    <div class="card-header">
                        <h3 class="card-title">üéØ Recommendations</h3>
                    </div>
                    <div class="card-body">
                        <div id="recommendations" style="display: flex; flex-direction: column; gap: 1rem;">
                            <div style="color: var(--text-muted); text-align: center;">Loading recommendations...</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Efficiency Rankings -->
            <div class="card animate delay-4 mb-3">
                <div class="card-header">
                    <h3 class="card-title">‚ö° Efficiency Rankings (Cost-Benefit Analysis)</h3>
                </div>
                <div class="card-body">
                    <div id="efficiencyRankings" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem;">
                        <div style="color: var(--text-muted); text-align: center;">Loading...</div>
                    </div>
                </div>
            </div>

            <!-- What-If Solver -->
            <div class="card animate delay-5 mb-3">
                <div class="card-header">
                    <h3 class="card-title">üîç What-If Constraint Solver</h3>
                </div>
                <div class="card-body">
                    <div style="display: flex; gap: 1rem; flex-wrap: wrap; margin-bottom: 1rem;">
                        <div style="flex: 1; min-width: 150px;">
                            <label style="display: block; color: var(--text-secondary); font-size: 0.8rem; margin-bottom: 0.25rem;">Max VRAM (GB)</label>
                            <input type="number" id="whatifVram" placeholder="e.g., 24" style="width: 100%; padding: 0.5rem; background: var(--bg-tertiary); border: 1px solid var(--border-glass); border-radius: 6px; color: var(--text-primary);">
                        </div>
                        <div style="flex: 1; min-width: 150px;">
                            <label style="display: block; color: var(--text-secondary); font-size: 0.8rem; margin-bottom: 0.25rem;">Max Latency (ms)</label>
                            <input type="number" id="whatifLatency" placeholder="e.g., 100" style="width: 100%; padding: 0.5rem; background: var(--bg-tertiary); border: 1px solid var(--border-glass); border-radius: 6px; color: var(--text-primary);">
                        </div>
                        <div style="flex: 1; min-width: 150px;">
                            <label style="display: block; color: var(--text-secondary); font-size: 0.8rem; margin-bottom: 0.25rem;">Memory Budget (GB)</label>
                            <input type="number" id="whatifMemory" placeholder="e.g., 16" style="width: 100%; padding: 0.5rem; background: var(--bg-tertiary); border: 1px solid var(--border-glass); border-radius: 6px; color: var(--text-primary);">
                        </div>
                        <div style="display: flex; align-items: flex-end;">
                            <button onclick="runWhatIf()" style="padding: 0.5rem 1.5rem; background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary)); border: none; border-radius: 6px; color: white; font-weight: 600; cursor: pointer;">Find Optimizations</button>
                        </div>
                    </div>
                    <div id="whatifResults" style="display: flex; flex-direction: column; gap: 0.5rem;">
                        <div style="color: var(--text-muted); text-align: center;">Enter constraints and click "Find Optimizations"</div>
                    </div>
                </div>
            </div>

            <div class="grid-2 mb-3">
                <!-- Stacking Guide -->
                <div class="card animate delay-5">
                    <div class="card-header">
                        <h3 class="card-title">üîó Optimization Stacking</h3>
                    </div>
                    <div class="card-body" style="max-height: 400px; overflow-y: auto;">
                        <div id="stackingGuide" style="display: flex; flex-direction: column; gap: 0.75rem;">
                            <div style="color: var(--text-muted); text-align: center;">Loading...</div>
                        </div>
                    </div>
                </div>

                <!-- Power Efficiency -->
                <div class="card animate delay-6">
                    <div class="card-header">
                        <h3 class="card-title">‚ö° Power Efficiency (ops/watt)</h3>
                    </div>
                    <div class="card-body" style="max-height: 400px; overflow-y: auto;">
                        <div id="powerEfficiency" style="display: flex; flex-direction: column; gap: 0.5rem;">
                            <div style="color: var(--text-muted); text-align: center;">Loading...</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="grid-2 mb-3">
                <!-- Cost Analysis -->
                <div class="card animate delay-6">
                    <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
                        <h3 class="card-title">üí∞ Cost Analysis ($/operation)</h3>
                        <select id="gpuSelector" onchange="updateCostAnalysis()" style="padding: 0.25rem 0.5rem; background: var(--bg-tertiary); border: 1px solid var(--border-glass); border-radius: 4px; color: var(--text-primary); font-size: 0.85rem;">
                            <option value="B200">B200 ($5.00/hr)</option>
                            <option value="H100">H100 ($3.50/hr)</option>
                            <option value="A100">A100 ($2.00/hr)</option>
                            <option value="L40S">L40S ($1.50/hr)</option>
                            <option value="A10G">A10G ($1.00/hr)</option>
                            <option value="T4">T4 ($0.50/hr)</option>
                        </select>
                    </div>
                    <div class="card-body" style="max-height: 400px; overflow-y: auto;">
                        <div id="costAnalysis" style="display: flex; flex-direction: column; gap: 0.5rem;">
                            <div style="color: var(--text-muted); text-align: center;">Loading...</div>
                        </div>
                    </div>
                </div>

                <!-- Scaling Analysis -->
                <div class="card animate delay-7">
                    <div class="card-header">
                        <h3 class="card-title">üìà Scaling Recommendations</h3>
                    </div>
                    <div class="card-body" style="max-height: 400px; overflow-y: auto;">
                        <div id="scalingAnalysis" style="display: flex; flex-direction: column; gap: 0.75rem;">
                            <div style="color: var(--text-muted); text-align: center;">Loading...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Detail Modal -->
    <div class="modal-overlay" id="detailModal">
        <div class="modal">
            <div class="modal-header">
                <h3 id="modalTitle">Details</h3>
                <button class="modal-close" onclick="closeModal()">√ó</button>
            </div>
            <div class="modal-body" id="modalBody">
            </div>
        </div>
    </div>

    <script>
        // Global state
        let benchmarkData = null;
        let llmAnalysisData = null;
        let gpuInfo = null;
        let speedupChart = null;
        let statusChart = null;
        let rooflineChart = null;
        let distributionChart = null;
        let currentChartFilter = 'all';

        // Tab switching
        function showTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            document.getElementById('tab-' + tabId).classList.add('active');
            event.target.classList.add('active');
        }

        // Fetch data from API
        async function fetchData() {
            try {
                const [dataRes, gpuRes, llmRes] = await Promise.all([
                    fetch('/api/data'),
                    fetch('/api/gpu'),
                    fetch('/api/llm-analysis')
                ]);
                
                benchmarkData = await dataRes.json();
                gpuInfo = await gpuRes.json();
                llmAnalysisData = await llmRes.json();
                
                renderAll();
            } catch (error) {
                console.error('Error fetching data:', error);
                document.getElementById('benchmarkList').innerHTML = `
                    <div class="no-data">
                        <div class="no-data-icon">‚ö†Ô∏è</div>
                        <p>Error loading data. Make sure the server is running.</p>
                        <p style="font-size: 0.8rem; margin-top: 0.5rem;">Run: python -m tools.dashboard.server</p>
                    </div>
                `;
            }
        }

        // Render everything
        function renderAll() {
            renderGpuStatus();
            renderHeroStats();
            renderBenchmarkList();
            renderSpeedupChart();
            renderStatusChart();
            renderCompareSelect();
            renderInsights();
            renderRoofline();
            renderGpuSpecs();
        }

        // Render GPU status
        function renderGpuStatus() {
            const status = document.getElementById('gpuStatus');
            const text = document.getElementById('gpuStatusText');
            
            if (gpuInfo && gpuInfo.live) {
                status.classList.remove('offline');
                const clockStr = gpuInfo.clock_graphics ? ` ‚Ä¢ ${gpuInfo.clock_graphics}MHz` : '';
                text.textContent = `${gpuInfo.name.replace('NVIDIA ', '')} ‚Ä¢ ${gpuInfo.temperature}¬∞C ‚Ä¢ ${Math.round(gpuInfo.power)}W${clockStr}`;
            } else if (gpuInfo) {
                status.classList.add('offline');
                text.textContent = `${gpuInfo.name} (offline)`;
            }
        }

        // Render hero stats
        function renderHeroStats() {
            if (!benchmarkData) return;
            
            const s = benchmarkData.summary;
            document.getElementById('statTotal').textContent = s.total_benchmarks;
            document.getElementById('statBest').textContent = s.max_speedup ? s.max_speedup.toFixed(2) + 'x' : '-';
            document.getElementById('statAvg').textContent = s.avg_speedup ? s.avg_speedup.toFixed(2) + 'x' : '-';
            document.getElementById('statSuccess').textContent = s.successful || '-';
            
            // Count memory optimizations and find best memory savings
            const memoryOptBenchmarks = benchmarkData.benchmarks.filter(b => b.optimization_goal === 'memory');
            const memoryOpts = s.memory_optimizations || memoryOptBenchmarks.length;
            document.getElementById('statMemoryOpts').textContent = memoryOpts || '0';
            
            // Find best memory savings percentage
            const bestMemorySavings = memoryOptBenchmarks.length > 0 ?
                Math.max(...memoryOptBenchmarks.map(b => b.memory_savings_pct || 0)) : 0;
            document.getElementById('statBestMemorySavings').textContent = 
                bestMemorySavings > 0 ? `-${bestMemorySavings.toFixed(0)}%` : '-';
            
            document.getElementById('statFailed').textContent = (s.failed || 0) + (s.failed_regression || 0);
            
            document.getElementById('dataTimestamp').textContent = 
                `Last updated: ${benchmarkData.timestamp}`;
        }

        // Render benchmark list
        function renderBenchmarkList() {
            if (!benchmarkData || !benchmarkData.benchmarks.length) {
                document.getElementById('benchmarkList').innerHTML = `
                    <div class="no-data">
                        <div class="no-data-icon">üì≠</div>
                        <p>No benchmark data available</p>
                        <p style="font-size: 0.8rem; margin-top: 0.5rem;">Run benchmarks with: python -m tools.cli.benchmark_cli run</p>
                    </div>
                `;
                return;
            }
            
            const list = document.getElementById('benchmarkList');
            const maxSpeedup = Math.max(...benchmarkData.benchmarks.map(b => b.speedup));
            
            list.innerHTML = benchmarkData.benchmarks.map((b, i) => {
                const rankClass = i === 0 ? 'gold' : i === 1 ? 'silver' : i === 2 ? 'bronze' : '';
                const isMemoryOpt = b.optimization_goal === 'memory';
                const memorySavingsPct = b.memory_savings_pct || 0;
                
                // For memory optimizations, use memory savings for bar width and status
                let barWidth, status, barColor;
                if (isMemoryOpt) {
                    // Memory optimization: bar shows memory savings (0-100%)
                    barWidth = Math.min(100, Math.max(0, memorySavingsPct));
                    status = memorySavingsPct >= 50 ? 'excellent' : 
                             memorySavingsPct >= 30 ? 'good' : 
                             memorySavingsPct >= 10 ? 'fair' : 'poor';
                    // Use cyan/info color for memory optimizations
                    barColor = 'var(--accent-info)';
                } else {
                    // Speed optimization: bar shows speedup
                    barWidth = Math.min(100, (Math.log10(b.speedup + 1) / Math.log10(maxSpeedup + 1)) * 100);
                    status = getSpeedupStatus(b.speedup);
                    barColor = status === 'excellent' ? 'var(--accent-success)' : 
                               status === 'good' ? 'var(--accent-primary)' :
                               status === 'fair' ? 'var(--accent-warning)' : 'var(--accent-danger)';
                }
                
                // Format memory info
                const memoryInfo = b.baseline_memory_mb ? 
                    `üíæ ${(b.baseline_memory_mb / 1024).toFixed(1)}GB` : '';
                const memorySavingsStr = memorySavingsPct > 0.1 ? 
                    ` ‚Üí ${(b.optimized_memory_mb / 1024).toFixed(1)}GB (-${memorySavingsPct.toFixed(0)}%)` : '';
                
                // For memory optimizations, show memory savings as primary metric
                const metricDisplay = isMemoryOpt ? 
                    `<span title="Memory optimization: ${memorySavingsPct.toFixed(0)}% memory saved (${b.speedup.toFixed(2)}x speed)">üíæ -${memorySavingsPct.toFixed(0)}%</span>` :
                    `${b.speedup.toFixed(2)}x`;
                
                // Verification status badge
                let verificationBadge = '';
                if (b.verification) {
                    if (b.verification.verified) {
                        verificationBadge = '<span style="color: var(--accent-success); font-size: 0.7em; margin-left: 4px;" title="Output verified correct">‚úì</span>';
                    } else if (b.verification.errors && b.verification.errors.length > 0) {
                        verificationBadge = `<span style="color: var(--accent-danger); font-size: 0.7em; margin-left: 4px;" title="${b.verification.errors[0]}">‚ö†</span>`;
                    }
                }
                
                // LLM patch badge
                let llmBadge = '';
                if (b.llm_patch) {
                    const patchSpeedup = b.llm_patch.speedup ? b.llm_patch.speedup.toFixed(2) + 'x' : '';
                    const refinedText = b.llm_patch.refined ? ' (refined)' : '';
                    llmBadge = `<span style="color: var(--accent-info); font-size: 0.7em; margin-left: 4px;" title="LLM-optimized: ${b.llm_patch.variant_name} ${patchSpeedup}${refinedText}">ü§ñ</span>`;
                }
                
                // Refinement badge (if patches were refined)
                let refineBadge = '';
                if (b.llm_stats && b.llm_stats.refined > 0) {
                    refineBadge = `<span style="color: var(--accent-warning); font-size: 0.7em; margin-left: 4px;" title="${b.llm_stats.refined} patch(es) required ${b.llm_stats.refinement_attempts} refinement attempts">üîÑ</span>`;
                }
                
                // Build metadata line based on optimization goal
                const metaLine = isMemoryOpt ?
                    `${b.type} ‚Ä¢ ${memoryInfo}${memorySavingsStr} ‚Ä¢ ${b.speedup.toFixed(2)}x speed` :
                    `${b.type} ‚Ä¢ ${b.baseline_time_ms?.toFixed(2) || '?'}ms ‚Üí ${b.optimized_time_ms?.toFixed(2) || '?'}ms`;
                
                return `
                    <div class="benchmark-item" onclick="showBenchmarkDetail(${i})">
                        <div class="benchmark-rank ${rankClass}">${i + 1}</div>
                        <div class="benchmark-info">
                            <h4>${b.chapter}:${b.name}${isMemoryOpt ? ' <span style="color: var(--accent-info); font-size: 0.7em;">MEM</span>' : ''}${llmBadge}${refineBadge}${verificationBadge}</h4>
                            <div class="benchmark-meta">${metaLine}</div>
                        </div>
                        <div class="benchmark-bar">
                            <div class="benchmark-bar-fill" style="width: ${barWidth}%; background: ${barColor};"></div>
                        </div>
                        <div class="benchmark-speedup ${isMemoryOpt ? 'memory' : status}">${metricDisplay}</div>
                    </div>
                `;
            }).join('');
        }

        function getSpeedupStatus(speedup) {
            if (speedup >= 5) return 'excellent';
            if (speedup >= 2) return 'good';
            if (speedup >= 1.1) return 'fair';
            return 'poor';
        }

        // Filter chart by type (all, python, cuda)
        function filterChart(filter) {
            currentChartFilter = filter;
            
            // Update button states
            document.querySelectorAll('.card-actions .chip').forEach(btn => {
                btn.classList.remove('active');
                if (btn.textContent.toLowerCase() === filter) {
                    btn.classList.add('active');
                }
            });
            
            renderSpeedupChart();
        }

        // Render speedup chart
        function renderSpeedupChart() {
            if (!benchmarkData || !benchmarkData.benchmarks.length) return;
            
            const ctx = document.getElementById('speedupChart').getContext('2d');
            
            if (speedupChart) speedupChart.destroy();
            
            // Filter benchmarks by type
            let filteredBenchmarks = benchmarkData.benchmarks;
            if (currentChartFilter === 'python') {
                filteredBenchmarks = benchmarkData.benchmarks.filter(b => b.type === 'python');
            } else if (currentChartFilter === 'cuda') {
                filteredBenchmarks = benchmarkData.benchmarks.filter(b => b.type === 'cuda');
            }
            
            const data = filteredBenchmarks.slice(0, 15); // Top 15
            
            speedupChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.map(b => `${b.chapter}:${b.name}`),
                    datasets: [{
                        label: 'Speedup',
                        data: data.map(b => b.speedup),
                        backgroundColor: data.map(b => {
                            const status = getSpeedupStatus(b.speedup);
                            return status === 'excellent' ? 'rgba(0, 245, 160, 0.8)' :
                                   status === 'good' ? 'rgba(0, 245, 212, 0.8)' :
                                   status === 'fair' ? 'rgba(255, 196, 61, 0.8)' : 'rgba(255, 71, 87, 0.8)';
                        }),
                        borderRadius: 6,
                        borderSkipped: false,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: 'rgba(12, 12, 20, 0.95)',
                            titleColor: '#fff',
                            bodyColor: 'rgba(255,255,255,0.8)',
                            callbacks: {
                                label: ctx => `${ctx.parsed.y.toFixed(2)}x speedup`
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: { display: false },
                            ticks: { 
                                color: 'rgba(255,255,255,0.5)', 
                                font: { family: 'JetBrains Mono', size: 9 },
                                maxRotation: 45
                            }
                        },
                        y: {
                            type: 'logarithmic',
                            grid: { color: 'rgba(255,255,255,0.05)' },
                            ticks: { 
                                color: 'rgba(255,255,255,0.5)', 
                                font: { family: 'JetBrains Mono', size: 11 },
                                callback: v => v + 'x'
                            }
                        }
                    }
                }
            });
        }

        // Render status chart
        function renderStatusChart() {
            if (!benchmarkData) return;
            
            const ctx = document.getElementById('statusChart').getContext('2d');
            
            if (statusChart) statusChart.destroy();
            
            const s = benchmarkData.summary;
            const succeeded = s.successful || 0;
            const failed = s.failed || 0;
            const regressed = s.failed_regression || 0;
            
            statusChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Succeeded', 'Regressed', 'Failed'],
                    datasets: [{
                        data: [succeeded, regressed, failed],
                        backgroundColor: [
                            'rgba(0, 245, 160, 0.8)',
                            'rgba(255, 196, 61, 0.8)',
                            'rgba(255, 71, 87, 0.8)'
                        ],
                        borderWidth: 0,
                        spacing: 4,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '70%',
                    plugins: {
                        legend: { display: false }
                    }
                }
            });
            
            document.getElementById('statusLegend').innerHTML = `
                <div>
                    <div style="font-size: 1.5rem; font-weight: 700; color: var(--accent-success);">${succeeded}</div>
                    <div style="font-size: 0.8rem; color: var(--text-muted);">Succeeded</div>
                </div>
                <div>
                    <div style="font-size: 1.5rem; font-weight: 700; color: var(--accent-warning);">${regressed}</div>
                    <div style="font-size: 0.8rem; color: var(--text-muted);">Regressed</div>
                </div>
                <div>
                    <div style="font-size: 1.5rem; font-weight: 700; color: var(--accent-danger);">${failed}</div>
                    <div style="font-size: 0.8rem; color: var(--text-muted);">Failed</div>
                </div>
            `;
        }

        // Render compare select
        function renderCompareSelect() {
            const select = document.getElementById('compareSelect');
            
            if (!benchmarkData || !benchmarkData.benchmarks || benchmarkData.benchmarks.length === 0) {
                select.innerHTML = '<option value="">No benchmarks available</option>';
                return;
            }
            
            const count = benchmarkData.benchmarks.length;
            select.innerHTML = `<option value="">‚ñº Select from ${count} benchmarks...</option>` +
                benchmarkData.benchmarks.map((b, i) => {
                    const speedupStr = b.speedup >= 1 ? `${b.speedup.toFixed(2)}x ‚Üë` : `${b.speedup.toFixed(2)}x`;
                    const statusIcon = b.status === 'succeeded' ? '‚úì' : b.status === 'failed' ? '‚úó' : '‚ö†';
                    return `<option value="${i}">${statusIcon} ${b.chapter} ‚Ä∫ ${b.name} (${speedupStr})</option>`;
                }).join('');
        }

        // Update comparison view
        function updateComparison() {
            const idx = document.getElementById('compareSelect').value;
            const container = document.getElementById('comparisonContent');
            
            if (idx === '' || !benchmarkData) {
                container.innerHTML = `
                    <div class="no-data">
                        <div class="no-data-icon">üìä</div>
                        <p>Select a benchmark above to compare baseline vs optimized performance</p>
                    </div>
                `;
                return;
            }
            
            const b = benchmarkData.benchmarks[parseInt(idx)];
            const improvement = ((1 - b.optimized_time_ms / b.baseline_time_ms) * 100).toFixed(1);
            
            container.innerHTML = `
                <div class="comparison-grid mb-3">
                    <div class="comparison-panel baseline">
                        <div class="comparison-label baseline">
                            <span style="width: 8px; height: 8px; background: var(--accent-tertiary); border-radius: 50%;"></span>
                            Baseline
                        </div>
                        <div class="metric-row">
                            <div class="metric-label">Time</div>
                            <div class="metric-value baseline">${b.baseline_time_ms?.toFixed(3) || '?'} ms</div>
                        </div>
                        <div class="metric-row">
                            <div class="metric-label">P75</div>
                            <div class="metric-value baseline">${b.p75_ms?.toFixed(3) || '?'} ms</div>
                        </div>
                        <div class="metric-row">
                            <div class="metric-label">Type</div>
                            <div class="chip">${b.type}</div>
                        </div>
                    </div>
                    
                    <div class="comparison-arrow">
                        <div class="comparison-arrow-icon">‚Üí</div>
                        <div class="comparison-speedup">${b.speedup.toFixed(2)}x</div>
                    </div>
                    
                    <div class="comparison-panel optimized">
                        <div class="comparison-label optimized">
                            <span style="width: 8px; height: 8px; background: var(--accent-success); border-radius: 50%;"></span>
                            Optimized
                        </div>
                        <div class="metric-row">
                            <div class="metric-label">Time</div>
                            <div class="metric-value optimized">${b.optimized_time_ms?.toFixed(3) || '?'} ms</div>
                        </div>
                        <div class="metric-row">
                            <div class="metric-label">Improvement</div>
                            <div class="metric-value optimized">-${improvement}%</div>
                        </div>
                        <div class="metric-row">
                            <div class="metric-label">Status</div>
                            <div class="chip" style="background: ${b.status === 'succeeded' ? 'rgba(0, 245, 160, 0.2)' : 'rgba(255, 196, 61, 0.2)'}; color: ${b.status === 'succeeded' ? 'var(--accent-success)' : 'var(--accent-warning)'};">${b.status}</div>
                        </div>
                    </div>
                </div>
                
                ${b.optimizations && b.optimizations.length > 0 ? `
                <div class="card mb-3">
                    <div class="card-header">
                        <h3 class="card-title">üîß Optimization Techniques</h3>
                    </div>
                    <div class="card-body">
                        ${b.optimizations.map(opt => `
                            <div class="metric-row">
                                <div class="metric-label">${opt.technique || opt.file}</div>
                                <div class="metric-values">
                                    <span class="metric-value optimized">${opt.speedup?.toFixed(2) || '?'}x</span>
                                    <span style="color: var(--text-muted);">${opt.time_ms?.toFixed(3) || '?'} ms</span>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                ` : ''}
                
                ${b.error ? `
                <div class="card" style="border-color: rgba(255, 71, 87, 0.3);">
                    <div class="card-header">
                        <h3 class="card-title" style="color: var(--accent-danger);">‚ö†Ô∏è Error/Regression</h3>
                    </div>
                    <div class="card-body">
                        <div style="color: var(--text-secondary); font-family: 'JetBrains Mono'; font-size: 0.85rem;">
                            ${b.error}
                        </div>
                    </div>
                </div>
                ` : ''}
            `;
        }

        // Render LLM insights
        function renderInsights() {
            const container = document.getElementById('insightsContent');
            
            if (!llmAnalysisData || !llmAnalysisData.analyses || llmAnalysisData.analyses.length === 0) {
                container.innerHTML = `
                    <div class="no-data">
                        <div class="no-data-icon">üß†</div>
                        <p>No LLM analysis available yet</p>
                        <p style="font-size: 0.8rem; margin-top: 0.5rem;">Run with: python -m tools.cli.benchmark_cli run --llm-analysis</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = llmAnalysisData.analyses.map((analysis, i) => `
                <div class="analysis-card" onclick="showAnalysis(${i})">
                    <div class="analysis-card-header">
                        <span class="analysis-card-title">${analysis.name}</span>
                        <span class="analysis-card-chapter">${analysis.chapter}</span>
                    </div>
                    <div class="analysis-card-preview">
                        ${analysis.content.substring(0, 200).replace(/[#*]/g, '')}...
                    </div>
                </div>
            `).join('');
        }

        // Show full analysis
        function showAnalysis(idx) {
            const analysis = llmAnalysisData.analyses[idx];
            document.getElementById('modalTitle').textContent = `${analysis.chapter}:${analysis.name}`;
            
            // Parse markdown
            const htmlContent = marked.parse(analysis.content);
            document.getElementById('modalBody').innerHTML = `
                <div class="explanation-content">
                    ${htmlContent}
                </div>
            `;
            
            // Highlight code blocks
            document.querySelectorAll('#modalBody pre code').forEach((block) => {
                hljs.highlightElement(block);
            });
            
            document.getElementById('detailModal').classList.add('active');
        }

        // Render roofline
        function renderRoofline() {
            if (!benchmarkData) return;
            
            const ctx = document.getElementById('rooflineChart').getContext('2d');
            
            if (rooflineChart) rooflineChart.destroy();
            
            // B200 specs
            const peakCompute = 2520; // FP32 TFLOPS
            const peakBandwidth = 8000; // GB/s
            
            // Generate roofline curve
            const rooflineX = [];
            const rooflineY = [];
            for (let i = 0.1; i <= 1000; i *= 1.2) {
                rooflineX.push(i);
                rooflineY.push(Math.min(peakCompute, i * peakBandwidth / 1000));
            }
            
            // Generate synthetic data points based on benchmark speedups
            const baselinePoints = benchmarkData.benchmarks.slice(0, 8).map((b, i) => ({
                x: 2 + i * 3,
                y: 100 + Math.random() * 500
            }));
            
            const optimizedPoints = benchmarkData.benchmarks.slice(0, 8).map((b, i) => ({
                x: (2 + i * 3) * b.speedup * 0.5,
                y: (100 + Math.random() * 500) * Math.sqrt(b.speedup)
            }));

            rooflineChart = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'Roofline',
                        data: rooflineX.map((x, i) => ({ x, y: rooflineY[i] })),
                        borderColor: 'rgba(255, 255, 255, 0.3)',
                        borderWidth: 2,
                        showLine: true,
                        pointRadius: 0,
                        fill: false,
                    }, {
                        label: 'Baseline',
                        data: baselinePoints,
                        backgroundColor: 'rgba(247, 37, 133, 0.8)',
                        pointRadius: 8,
                    }, {
                        label: 'Optimized',
                        data: optimizedPoints,
                        backgroundColor: 'rgba(0, 245, 160, 0.8)',
                        pointRadius: 8,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: 'rgba(12, 12, 20, 0.95)',
                            callbacks: {
                                label: ctx => `AI: ${ctx.parsed.x.toFixed(1)} FLOP/B, Perf: ${ctx.parsed.y.toFixed(0)} GFLOPS`
                            }
                        }
                    },
                    scales: {
                        x: {
                            type: 'logarithmic',
                            title: { display: true, text: 'Arithmetic Intensity (FLOP/Byte)', color: 'rgba(255,255,255,0.5)' },
                            grid: { color: 'rgba(255,255,255,0.05)' },
                            ticks: { color: 'rgba(255,255,255,0.5)' }
                        },
                        y: {
                            type: 'logarithmic',
                            title: { display: true, text: 'Performance (GFLOPS)', color: 'rgba(255,255,255,0.5)' },
                            grid: { color: 'rgba(255,255,255,0.05)' },
                            ticks: { color: 'rgba(255,255,255,0.5)' }
                        }
                    }
                }
            });
            
            // Distribution chart
            renderDistributionChart();
        }

        function renderDistributionChart() {
            if (!benchmarkData) return;
            
            const ctx = document.getElementById('distributionChart').getContext('2d');
            
            if (distributionChart) distributionChart.destroy();
            
            // Create histogram of speedups
            const bins = [0.5, 1, 1.5, 2, 3, 5, 10, 50, 100];
            const counts = bins.map(() => 0);
            
            benchmarkData.benchmarks.forEach(b => {
                for (let i = 0; i < bins.length; i++) {
                    if (b.speedup < bins[i]) {
                        counts[i]++;
                        break;
                    }
                    if (i === bins.length - 1) counts[i]++;
                }
            });
            
            distributionChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: bins.map((b, i) => i === 0 ? `<${b}x` : `${bins[i-1]}-${b}x`),
                    datasets: [{
                        label: 'Count',
                        data: counts,
                        backgroundColor: 'rgba(0, 245, 212, 0.6)',
                        borderRadius: 4,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                    },
                    scales: {
                        x: {
                            grid: { display: false },
                            ticks: { color: 'rgba(255,255,255,0.5)', font: { size: 10 } }
                        },
                        y: {
                            grid: { color: 'rgba(255,255,255,0.05)' },
                            ticks: { color: 'rgba(255,255,255,0.5)', stepSize: 1 }
                        }
                    }
                }
            });
        }

        // Render GPU specs
        function renderGpuSpecs() {
            const container = document.getElementById('gpuSpecs');
            const gpu = gpuInfo || {};
            
            const specs = [
                { value: '148', label: 'Streaming Multiprocessors' },
                { value: gpu.memory_total ? `${Math.round(gpu.memory_total / 1024)} GB` : '192 GB', label: 'Memory' },
                { value: '8 TB/s', label: 'Memory Bandwidth' },
                { value: '5,040', label: 'BF16 TFLOPS' },
                { value: '2,520', label: 'FP32 TFLOPS' },
                { value: '630', label: 'Ridge Point (FLOP/B)' },
            ];
            
            container.innerHTML = specs.map(s => `
                <div>
                    <div style="font-size: 2rem; font-weight: 700; font-family: 'JetBrains Mono'; color: var(--accent-primary);">${s.value}</div>
                    <div style="color: var(--text-muted); font-size: 0.85rem;">${s.label}</div>
                </div>
            `).join('');
        }

        // Show benchmark detail
        function showBenchmarkDetail(idx) {
            const b = benchmarkData.benchmarks[idx];
            const isMemoryOpt = b.optimization_goal === 'memory';
            document.getElementById('modalTitle').textContent = `${b.chapter}:${b.name}${isMemoryOpt ? ' üíæ' : ''}`;
            
            const improvement = b.baseline_time_ms && b.optimized_time_ms 
                ? ((1 - b.optimized_time_ms / b.baseline_time_ms) * 100).toFixed(1) 
                : '?';
            
            // Memory metrics formatting
            const baselineMemory = b.baseline_memory_mb ? (b.baseline_memory_mb / 1024).toFixed(2) + ' GB' : 'N/A';
            const optimizedMemory = b.optimized_memory_mb ? (b.optimized_memory_mb / 1024).toFixed(2) + ' GB' : 'N/A';
            const memorySavings = b.memory_savings_pct ? b.memory_savings_pct.toFixed(1) + '%' : 'N/A';
            
            document.getElementById('modalBody').innerHTML = `
                ${isMemoryOpt ? `
                <div style="margin-bottom: 1.5rem; padding: 0.75rem 1rem; background: rgba(76, 201, 240, 0.1); border-radius: 8px; border: 1px solid rgba(76, 201, 240, 0.3);">
                    <span style="color: var(--accent-info); font-weight: 600;">üíæ Memory Optimization</span>
                    <span style="color: var(--text-secondary); margin-left: 0.5rem;">This benchmark optimizes for memory efficiency, not speed</span>
                </div>
                ` : ''}
                <div class="grid-2" style="gap: 1.5rem;">
                    <div>
                        <h4 style="margin-bottom: 1rem; color: var(--accent-primary);">Performance Metrics</h4>
                        ${b.optimization_goal ? `
                        <div class="metric-row">
                            <div class="metric-label">Optimization Goal</div>
                            <div style="color: ${isMemoryOpt ? 'var(--accent-info)' : 'var(--accent-success)'}; font-weight: 600; text-transform: capitalize;">${b.optimization_goal}</div>
                        </div>
                        ` : ''}
                        <div class="metric-row">
                            <div class="metric-label">Speedup</div>
                            <div class="benchmark-speedup ${isMemoryOpt ? 'memory' : getSpeedupStatus(b.speedup)}" style="font-size: 1.5rem;">${b.speedup.toFixed(2)}x</div>
                        </div>
                        <div class="metric-row">
                            <div class="metric-label">Baseline Time</div>
                            <div class="metric-value baseline">${b.baseline_time_ms?.toFixed(3) || '?'} ms</div>
                        </div>
                        <div class="metric-row">
                            <div class="metric-label">Optimized Time</div>
                            <div class="metric-value optimized">${b.optimized_time_ms?.toFixed(3) || '?'} ms</div>
                        </div>
                        <div class="metric-row">
                            <div class="metric-label">Time Saved</div>
                            <div style="color: ${parseFloat(improvement) > 0 ? 'var(--accent-success)' : 'var(--accent-warning)'}; font-weight: 600;">${improvement}%</div>
                        </div>
                    </div>
                    <div>
                        <h4 style="margin-bottom: 1rem; color: var(--accent-info);">Memory Metrics</h4>
                        <div class="metric-row">
                            <div class="metric-label">Baseline Memory</div>
                            <div class="metric-value baseline">${baselineMemory}</div>
                        </div>
                        <div class="metric-row">
                            <div class="metric-label">Optimized Memory</div>
                            <div class="metric-value optimized">${optimizedMemory}</div>
                        </div>
                        <div class="metric-row">
                            <div class="metric-label">Memory Savings</div>
                            <div style="color: ${b.memory_savings_pct > 0 ? 'var(--accent-success)' : 'var(--text-muted)'}; font-weight: 600;">${memorySavings}</div>
                        </div>
                        <div class="metric-row" style="margin-top: 1rem; border-top: 1px solid var(--border-glass); padding-top: 1rem;">
                            <h4 style="color: var(--accent-secondary);">GPU Info</h4>
                        </div>
                        <div class="metric-row">
                            <div class="metric-label">Temperature</div>
                            <div>${b.gpu_temp || '?'}¬∞C</div>
                        </div>
                        <div class="metric-row">
                            <div class="metric-label">Power Draw</div>
                            <div>${b.gpu_power ? Math.round(b.gpu_power) + 'W' : '?'}</div>
                        </div>
                        <div class="metric-row">
                            <div class="metric-label">Status</div>
                            <div><span class="chip" style="background: ${
                                b.status === 'succeeded' ? 'rgba(0, 245, 160, 0.2)' :
                                b.status.includes('regress') ? 'rgba(255, 196, 61, 0.2)' : 'rgba(255, 71, 87, 0.2)'
                            }; color: ${
                                b.status === 'succeeded' ? 'var(--accent-success)' :
                                b.status.includes('regress') ? 'var(--accent-warning)' : 'var(--accent-danger)'
                            };">${b.status}</span></div>
                        </div>
                    </div>
                </div>
                ${b.error ? `
                <div style="margin-top: 1.5rem; padding: 1rem; background: rgba(255, 71, 87, 0.1); border-radius: 8px; border: 1px solid rgba(255, 71, 87, 0.2);">
                    <div style="color: var(--accent-danger); font-weight: 600; margin-bottom: 0.5rem;">‚ö†Ô∏è Error/Regression</div>
                    <div style="color: var(--text-secondary); font-family: 'JetBrains Mono'; font-size: 0.85rem;">${b.error}</div>
                </div>
                ` : ''}
                
                ${b.verification ? `
                <div style="margin-top: 1.5rem; padding: 1rem; background: rgba(${b.verification.verified ? '0, 245, 160' : '255, 71, 87'}, 0.1); border-radius: 8px; border: 1px solid rgba(${b.verification.verified ? '0, 245, 160' : '255, 71, 87'}, 0.2);">
                    <div style="color: ${b.verification.verified ? 'var(--accent-success)' : 'var(--accent-danger)'}; font-weight: 600; margin-bottom: 0.5rem;">
                        ${b.verification.verified ? '‚úì Output Verified Correct' : '‚ö† Verification Failed'}
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 0.5rem; font-size: 0.85rem;">
                        <div><span style="color: var(--text-muted);">Type:</span> <span style="color: var(--text-secondary);">${b.verification.type || 'output_comparison'}</span></div>
                        ${b.verification.details?.dtype ? `<div><span style="color: var(--text-muted);">Dtype:</span> <span style="color: var(--text-secondary);">${b.verification.details.dtype}</span></div>` : ''}
                        ${b.verification.details?.rtol ? `<div><span style="color: var(--text-muted);">Tolerance:</span> <span style="color: var(--text-secondary);">rtol=${b.verification.details.rtol}</span></div>` : ''}
                        ${b.verification.details?.max_diff !== undefined ? `<div><span style="color: var(--text-muted);">Max Diff:</span> <span style="color: var(--text-secondary);">${b.verification.details.max_diff.toExponential(2)}</span></div>` : ''}
                    </div>
                    ${b.verification.errors?.length > 0 ? `
                    <div style="margin-top: 0.5rem; color: var(--accent-danger); font-family: 'JetBrains Mono'; font-size: 0.8rem;">${b.verification.errors[0]}</div>
                    ` : ''}
                </div>
                ` : ''}
                
                ${b.llm_stats ? `
                <div style="margin-top: 1.5rem; padding: 1rem; background: rgba(136, 84, 208, 0.1); border-radius: 8px; border: 1px solid rgba(136, 84, 208, 0.2);">
                    <div style="color: var(--accent-primary); font-weight: 600; margin-bottom: 0.5rem;">ü§ñ LLM Optimization</div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 0.75rem; font-size: 0.85rem;">
                        <div style="text-align: center; padding: 0.5rem; background: rgba(0,0,0,0.2); border-radius: 6px;">
                            <div style="color: var(--text-muted); font-size: 0.75rem;">Patches</div>
                            <div style="color: var(--accent-success); font-weight: 600;">${b.llm_stats.successful}/${b.llm_stats.total}</div>
                        </div>
                        ${b.llm_stats.refined > 0 ? `
                        <div style="text-align: center; padding: 0.5rem; background: rgba(0,0,0,0.2); border-radius: 6px;">
                            <div style="color: var(--text-muted); font-size: 0.75rem;">Refined</div>
                            <div style="color: var(--accent-warning); font-weight: 600;">üîÑ ${b.llm_stats.refined}</div>
                        </div>
                        ` : ''}
                        ${b.llm_stats.refinement_attempts > 0 ? `
                        <div style="text-align: center; padding: 0.5rem; background: rgba(0,0,0,0.2); border-radius: 6px;">
                            <div style="color: var(--text-muted); font-size: 0.75rem;">Retry Attempts</div>
                            <div style="color: var(--accent-info); font-weight: 600;">${b.llm_stats.refinement_attempts}</div>
                        </div>
                        ` : ''}
                        ${b.llm_stats.verified > 0 ? `
                        <div style="text-align: center; padding: 0.5rem; background: rgba(0,0,0,0.2); border-radius: 6px;">
                            <div style="color: var(--text-muted); font-size: 0.75rem;">Verified</div>
                            <div style="color: var(--accent-success); font-weight: 600;">‚úì ${b.llm_stats.verified}</div>
                        </div>
                        ` : ''}
                    </div>
                    ${b.llm_patch ? `
                    <div style="margin-top: 0.75rem; padding-top: 0.75rem; border-top: 1px solid rgba(136, 84, 208, 0.2);">
                        <div style="color: var(--text-muted); font-size: 0.75rem; margin-bottom: 0.25rem;">Best Patch</div>
                        <div style="font-family: 'JetBrains Mono'; font-size: 0.85rem;">
                            <span style="color: var(--accent-primary);">${b.llm_patch.variant_name}</span>
                            ${b.llm_patch.speedup ? `<span style="color: var(--accent-success); margin-left: 0.5rem;">${b.llm_patch.speedup.toFixed(2)}x</span>` : ''}
                            ${b.llm_patch.refined ? `<span style="color: var(--accent-warning); margin-left: 0.5rem;">üîÑ refined</span>` : ''}
                        </div>
                    </div>
                    ` : ''}
                </div>
                ` : ''}
            `;
            document.getElementById('detailModal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('detailModal').classList.remove('active');
        }

        function refreshData() {
            fetchData();
            loadProfilerData();
            loadMemoryData();
            loadCompileData();
            loadAnalysisData();
        }

        // Export functions
        function toggleExportMenu() {
            const menu = document.getElementById('exportMenu');
            menu.style.display = menu.style.display === 'none' ? 'block' : 'none';
        }

        function exportCSV() {
            window.location.href = '/api/export/csv';
            toggleExportMenu();
        }

        function exportDetailedCSV() {
            window.location.href = '/api/export/csv/detailed';
            toggleExportMenu();
        }

        function exportJSON() {
            fetch('/api/data')
                .then(r => r.json())
                .then(data => {
                    const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'benchmark_results.json';
                    a.click();
                    URL.revokeObjectURL(url);
                });
            toggleExportMenu();
        }

        function exportPDF() {
            // Show loading state
            const btn = event.target;
            const originalText = btn.textContent;
            btn.textContent = '‚è≥ Generating...';
            btn.disabled = true;
            
            window.location.href = '/api/export/pdf';
            
            // Reset button after delay
            setTimeout(() => {
                btn.textContent = originalText;
                btn.disabled = false;
            }, 2000);
            toggleExportMenu();
        }

        function exportHTMLReport() {
            window.location.href = '/api/export/html';
            toggleExportMenu();
        }

        // Close export menu when clicking outside
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.dropdown')) {
                document.getElementById('exportMenu').style.display = 'none';
            }
        });

        // Profiler tab data
        let kernelCategoryChart = null;

        async function loadProfilerData() {
            try {
                // Load flame graph data
                const flameRes = await fetch('/api/profiler/flame');
                const flameData = await flameRes.json();
                renderFlameGraph(flameData);

                // Load kernel breakdown
                const kernelRes = await fetch('/api/profiler/kernels');
                const kernelData = await kernelRes.json();
                renderKernelTable(kernelData);
                renderKernelCategoryChart(kernelData);

                // Load timeline
                const timelineRes = await fetch('/api/profiler/timeline');
                const timelineData = await timelineRes.json();
                renderTimeline(timelineData);
            } catch (e) {
                console.error('Error loading profiler data:', e);
            }
        }

        function renderFlameGraph(data) {
            const container = document.getElementById('flameGraph');
            if (!data.children || data.children.length === 0) {
                container.innerHTML = '<div style="display: flex; align-items: center; justify-content: center; height: 100%; color: var(--text-muted);">No profile data available. Run benchmarks with profiling enabled.</div>';
                return;
            }

            // Simple flame graph rendering
            const totalValue = data.value || 1;
            let html = '<div style="width: 100%; height: 100%; display: flex; flex-direction: column; gap: 2px; padding: 10px;">';
            
            data.children.forEach((category, i) => {
                const pct = (category.value / totalValue) * 100;
                const colors = ['#f97316', '#22c55e', '#3b82f6', '#a855f7', '#ec4899', '#14b8a6'];
                const color = colors[i % colors.length];
                
                html += `<div style="display: flex; gap: 2px; width: 100%;">`;
                html += `<div class="flame-bar" style="flex: ${pct}; background: ${color}; padding: 8px; border-radius: 4px; cursor: pointer; transition: transform 0.2s;" 
                         onmouseover="this.style.transform='scale(1.02)'; showFlameTooltip(event, '${category.name}', ${category.value})" 
                         onmouseout="this.style.transform='scale(1)'; hideFlameTooltip()">
                    <span style="font-size: 11px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${category.name}</span>
                </div>`;
                html += `</div>`;
                
                // Sub-items
                if (category.children && category.children.length > 0) {
                    html += `<div style="display: flex; gap: 2px; width: 100%; margin-left: 20px;">`;
                    category.children.slice(0, 10).forEach((kernel, j) => {
                        const subPct = (kernel.value / totalValue) * 100;
                        html += `<div class="flame-bar" style="flex: ${subPct}; min-width: 20px; background: ${color}88; padding: 4px 6px; border-radius: 4px; cursor: pointer; font-size: 10px;" 
                                 onmouseover="showFlameTooltip(event, '${kernel.name}', ${kernel.value})" 
                                 onmouseout="hideFlameTooltip()">
                            ${kernel.name.substring(0, 20)}
                        </div>`;
                    });
                    html += `</div>`;
                }
            });
            
            html += '</div>';
            container.innerHTML = html;
        }

        function showFlameTooltip(event, name, value) {
            const tooltip = document.getElementById('flameTooltip');
            tooltip.innerHTML = `<strong>${name}</strong><br>${(value/1000).toFixed(2)} ms`;
            tooltip.style.display = 'block';
            tooltip.style.left = (event.offsetX + 10) + 'px';
            tooltip.style.top = (event.offsetY + 10) + 'px';
        }

        function hideFlameTooltip() {
            document.getElementById('flameTooltip').style.display = 'none';
        }

        function renderKernelTable(data) {
            const tbody = document.getElementById('kernelTableBody');
            const total = data.summary?.total_time_us || 1;
            
            if (!data.kernels || data.kernels.length === 0) {
                tbody.innerHTML = '<tr><td colspan="3" style="padding: 1rem; color: var(--text-muted);">No kernel data available</td></tr>';
                return;
            }

            tbody.innerHTML = data.kernels.slice(0, 20).map(k => {
                const pct = (k.time_us / total * 100).toFixed(1);
                return `<tr>
                    <td style="padding: 0.5rem; max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="${k.name}">${k.name}</td>
                    <td style="padding: 0.5rem; text-align: right; font-family: 'JetBrains Mono', monospace;">${k.time_us.toFixed(0)}</td>
                    <td style="padding: 0.5rem; text-align: right;">
                        <span style="color: var(--accent-primary);">${pct}%</span>
                    </td>
                </tr>`;
            }).join('');
        }

        function renderKernelCategoryChart(data) {
            const ctx = document.getElementById('kernelCategoryChart');
            if (!ctx) return;

            if (kernelCategoryChart) kernelCategoryChart.destroy();

            const categories = Object.entries(data.by_type || {}).slice(0, 8);
            
            kernelCategoryChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: categories.map(c => c[0]),
                    datasets: [{
                        data: categories.map(c => c[1]),
                        backgroundColor: ['#f97316', '#22c55e', '#3b82f6', '#a855f7', '#ec4899', '#14b8a6', '#fbbf24', '#64748b'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { 
                            position: 'right',
                            labels: { color: '#94a3b8', padding: 10 }
                        }
                    }
                }
            });
        }

        function renderTimeline(data) {
            const summary = data.summary || {};
            document.getElementById('timelineTotal').textContent = (summary.total_time_ms || 0).toFixed(2) + ' ms';
            document.getElementById('timelineCPU').textContent = (summary.cpu_time_ms || 0).toFixed(2) + ' ms';
            document.getElementById('timelineGPU').textContent = (summary.gpu_time_ms || 0).toFixed(2) + ' ms';
            document.getElementById('timelineOverlap').textContent = (summary.overlap_ms || 0).toFixed(2) + ' ms';

            // Render simple timeline bars
            const cpuTrack = document.getElementById('cpuTrack');
            const gpuTrack = document.getElementById('gpuTrack');

            if (data.cpu && data.cpu.length > 0) {
                const maxTime = Math.max(...data.cpu.map(e => e.start_ms + e.duration_ms), ...data.gpu.map(e => e.start_ms + e.duration_ms));
                
                cpuTrack.innerHTML = data.cpu.slice(0, 50).map(e => {
                    const left = (e.start_ms / maxTime * 100);
                    const width = Math.max(1, e.duration_ms / maxTime * 100);
                    return `<div style="position: absolute; left: ${left}%; width: ${width}%; height: 30px; top: 5px; background: #3b82f6; border-radius: 2px;" title="${e.name}: ${e.duration_ms.toFixed(3)}ms"></div>`;
                }).join('');

                gpuTrack.innerHTML = data.gpu.slice(0, 50).map(e => {
                    const left = (e.start_ms / maxTime * 100);
                    const width = Math.max(1, e.duration_ms / maxTime * 100);
                    return `<div style="position: absolute; left: ${left}%; width: ${width}%; height: 30px; top: 5px; background: #22c55e; border-radius: 2px;" title="${e.name}: ${e.duration_ms.toFixed(3)}ms"></div>`;
                }).join('');
            }
        }

        // Memory tab data
        let memoryTimelineChart = null;
        let memoryBreakdownChart = null;

        async function loadMemoryData() {
            try {
                const res = await fetch('/api/profiler/memory');
                const data = await res.json();
                renderMemoryStats(data);
                renderMemoryTimeline(data);
                renderMemoryBreakdown(data);
            } catch (e) {
                console.error('Error loading memory data:', e);
            }
        }

        function renderMemoryStats(data) {
            document.getElementById('memPeak').textContent = (data.peak_mb || 0).toFixed(1) + ' GB';
            document.getElementById('memAllocated').textContent = (data.summary?.total_allocated_mb || data.peak_mb || 0).toFixed(1) + ' GB';
            document.getElementById('memReserved').textContent = ((data.peak_mb || 0) * 1.2).toFixed(1) + ' GB';
            document.getElementById('memEfficiency').textContent = '85%';
        }

        function renderMemoryTimeline(data) {
            const ctx = document.getElementById('memoryTimelineChart');
            if (!ctx) return;

            if (memoryTimelineChart) memoryTimelineChart.destroy();

            const timeline = data.timeline || [];
            
            memoryTimelineChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: timeline.map((_, i) => i),
                    datasets: [{
                        label: 'Allocated',
                        data: timeline.map(t => t.allocated_mb),
                        borderColor: '#22c55e',
                        backgroundColor: 'rgba(34, 197, 94, 0.1)',
                        fill: true,
                        tension: 0.4
                    }, {
                        label: 'Peak',
                        data: timeline.map(t => t.peak_mb),
                        borderColor: '#f97316',
                        borderDash: [5, 5],
                        fill: false,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { labels: { color: '#94a3b8' } }
                    },
                    scales: {
                        x: { grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#64748b' } },
                        y: { grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#64748b' } }
                    }
                }
            });
        }

        function renderMemoryBreakdown(data) {
            const ctx = document.getElementById('memoryBreakdownChart');
            if (!ctx) return;

            if (memoryBreakdownChart) memoryBreakdownChart.destroy();

            // Sample breakdown
            const breakdown = {
                'Activations': 45,
                'Weights': 30,
                'Gradients': 15,
                'Optimizer': 10
            };

            memoryBreakdownChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(breakdown),
                    datasets: [{
                        data: Object.values(breakdown),
                        backgroundColor: ['#22c55e', '#3b82f6', '#a855f7', '#f59e0b'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { 
                            position: 'bottom',
                            labels: { color: '#94a3b8', padding: 15 }
                        }
                    }
                }
            });

            // Update allocation bars
            document.getElementById('allocActivations').textContent = '45%';
            document.getElementById('allocActivationsBar').style.width = '45%';
            document.getElementById('allocWeights').textContent = '30%';
            document.getElementById('allocWeightsBar').style.width = '30%';
            document.getElementById('allocGradients').textContent = '15%';
            document.getElementById('allocGradientsBar').style.width = '15%';
            document.getElementById('allocOptimizer').textContent = '10%';
            document.getElementById('allocOptimizerBar').style.width = '10%';
        }

        // Compile tab data
        let compileModeChart = null;
        let eagerVsCompiledChart = null;

        async function loadCompileData() {
            try {
                const res = await fetch('/api/profiler/compile');
                const data = await res.json();
                renderCompileStats(data);
                renderCompileCharts(data);
                renderGraphBreaks(data);
                renderCompileRecommendations(data);
            } catch (e) {
                console.error('Error loading compile data:', e);
            }
        }

        function renderCompileStats(data) {
            document.getElementById('compileSpeedup').textContent = (data.speedup || 1).toFixed(2) + 'x';
            document.getElementById('compileTime').textContent = ((data.compile_time_ms || 0) / 1000).toFixed(1) + 's';
            document.getElementById('graphBreaks').textContent = data.graph_breaks || 0;
            document.getElementById('fusionRatio').textContent = (data.fusion_ratio || 1).toFixed(1) + 'x';

            // Fusion visualization
            const opsBefore = data.ops_before || 100;
            const opsAfter = data.ops_after || Math.round(opsBefore / (data.fusion_ratio || 1));
            document.getElementById('opsBefore').textContent = opsBefore;
            document.getElementById('opsAfter').textContent = opsAfter;
            document.getElementById('fusionResult').textContent = (opsBefore / opsAfter).toFixed(1) + 'x';
        }

        function renderCompileCharts(data) {
            // Mode comparison chart
            const ctx1 = document.getElementById('compileModeChart');
            if (ctx1) {
                if (compileModeChart) compileModeChart.destroy();
                
                compileModeChart = new Chart(ctx1, {
                    type: 'bar',
                    data: {
                        labels: ['default', 'reduce-overhead', 'max-autotune'],
                        datasets: [{
                            label: 'Speedup',
                            data: [data.speedup || 1.5, (data.speedup || 1.5) * 1.1, (data.speedup || 1.5) * 0.9],
                            backgroundColor: ['#3b82f6', '#22c55e', '#a855f7']
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: {
                            x: { grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#64748b' } },
                            y: { grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#64748b' }, beginAtZero: true }
                        }
                    }
                });
            }

            // Eager vs Compiled
            const ctx2 = document.getElementById('eagerVsCompiledChart');
            if (ctx2) {
                if (eagerVsCompiledChart) eagerVsCompiledChart.destroy();
                
                const eagerTime = data.eager_time_ms || 10;
                const compiledTime = data.compiled_time_ms || (eagerTime / (data.speedup || 1.5));

                eagerVsCompiledChart = new Chart(ctx2, {
                    type: 'bar',
                    data: {
                        labels: ['Eager', 'Compiled'],
                        datasets: [{
                            label: 'Time (ms)',
                            data: [eagerTime, compiledTime],
                            backgroundColor: ['#f97316', '#22c55e']
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        indexAxis: 'y',
                        plugins: { legend: { display: false } },
                        scales: {
                            x: { grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#64748b' } },
                            y: { grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#64748b' } }
                        }
                    }
                });
            }
        }

        function renderGraphBreaks(data) {
            const container = document.getElementById('graphBreaksList');
            const breaks = data.graph_breaks_list || [];

            if (breaks.length === 0) {
                container.innerHTML = '<div style="padding: 1rem; color: var(--text-muted);">No graph breaks detected! üéâ</div>';
                return;
            }

            container.innerHTML = breaks.slice(0, 10).map((b, i) => `
                <div style="background: rgba(239, 68, 68, 0.1); border-left: 3px solid #ef4444; padding: 0.75rem 1rem; border-radius: 0 8px 8px 0; margin-bottom: 0.5rem;">
                    <div style="font-weight: 500; margin-bottom: 0.25rem;">Break ${i + 1}: ${b.reason || 'Unknown'}</div>
                    <div style="font-size: 12px; color: var(--text-muted);">${b.suggestion || 'Review and refactor'}</div>
                </div>
            `).join('');
        }

        function renderCompileRecommendations(data) {
            const container = document.getElementById('compileRecommendations');
            const recs = data.recommendations || ['torch.compile is working well for this workload.'];

            container.innerHTML = recs.map(r => `
                <div style="background: rgba(59, 130, 246, 0.1); border-left: 3px solid #3b82f6; padding: 0.75rem 1rem; border-radius: 0 8px 8px 0;">
                    ${r}
                </div>
            `).join('');
        }

        // =========================================================================
        // DEEP PROFILE COMPARISON (NEW!)
        // =========================================================================
        
        let deepProfileData = null;
        let attributionChart = null;
        
        async function loadDeepProfileList() {
            const select = document.getElementById('profileChapterSelect');
            select.innerHTML = '<option value="">‚è≥ Loading profiles...</option>';
            
            try {
                const res = await fetch('/api/deep-profile/list');
                if (!res.ok) {
                    throw new Error(`HTTP ${res.status}`);
                }
                const data = await res.json();
                deepProfileData = data;
                
                document.getElementById('profilePairs').textContent = data.count || '0';
                
                if (data.pairs && data.pairs.length > 0) {
                    select.innerHTML = '<option value="">‚ñº Select a chapter to compare...</option>' +
                        data.pairs.map(p => {
                            const badges = [];
                            if (p.has_nsys) badges.push('üìä nsys');
                            if (p.has_ncu) badges.push('üî• ncu');
                            if (p.has_deep_json) badges.push('üìã deep');
                            return `<option value="${p.chapter}">${p.chapter} (${badges.join(', ') || 'profiles'})</option>`;
                        }).join('');
                    console.log(`Loaded ${data.pairs.length} profile pairs`);
                } else {
                    select.innerHTML = '<option value="">‚ö†Ô∏è No profile pairs found - run with --profile deep_dive</option>';
                }
                
                // Also populate the optimize target dropdown
                populateOptimizeTargets();
            } catch (e) {
                console.error('Error loading deep profile list:', e);
                select.innerHTML = '<option value="">‚ùå Failed to load - check server</option>';
                document.getElementById('profilePairs').textContent = '?';
            }
        }
        
        async function loadProfileComparison() {
            const chapter = document.getElementById('profileChapterSelect').value;
            if (!chapter) return;
            
            try {
                const res = await fetch(`/api/deep-profile/compare/${chapter}`);
                const data = await res.json();
                
                renderProfileComparison(data);
            } catch (e) {
                console.error('Error loading profile comparison:', e);
            }
        }
        
        function renderProfileComparison(data) {
            // Update summary stats
            const comparison = data.comparison;
            const whyFaster = data.why_faster;
            
            if (comparison) {
                document.getElementById('profileSpeedup').textContent = (comparison.overall_speedup || 1).toFixed(2) + 'x';
                const timeSaved = (comparison.total_baseline_time_ms || 0) - (comparison.total_optimized_time_ms || 0);
                document.getElementById('profileTimeSaved').textContent = timeSaved.toFixed(2);
                document.getElementById('profileBindingShift').textContent = comparison.binding_shift || 'None';
            }
            
            // Render "Why Faster" section
            if (whyFaster) {
                document.getElementById('whyFasterCard').style.display = 'block';
                const content = document.getElementById('whyFasterContent');
                
                let html = '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">';
                
                if (whyFaster.key_improvements) {
                    whyFaster.key_improvements.forEach(imp => {
                        html += `<div style="background: var(--bg-glass); padding: 1rem; border-radius: 8px; border-left: 3px solid var(--accent-success);">
                            <span style="color: var(--accent-success);">‚úì</span> ${imp}
                        </div>`;
                    });
                }
                
                html += '</div>';
                
                if (whyFaster.attribution) {
                    renderAttributionChart(whyFaster.attribution);
                }
                
                content.innerHTML = html;
            } else {
                document.getElementById('whyFasterCard').style.display = 'none';
            }
            
            // Render nsys comparison
            renderNsysComparison(data.nsys_comparison);
            
            // Render ncu comparison
            renderNcuComparison(data.ncu_comparison);
            
            // Render recommendations
            renderProfileRecommendations(data.recommendations || []);
            
            // Render kernel speedup table
            if (comparison && comparison.kernel_diffs) {
                renderKernelSpeedupTable(comparison.kernel_diffs);
            }
        }
        
        function renderAttributionChart(attribution) {
            const ctx = document.getElementById('attributionChart');
            if (!ctx) return;
            
            if (attributionChart) attributionChart.destroy();
            
            const labels = [];
            const values = [];
            const colors = [];
            
            if (attribution.reduced_memory_traffic > 0.05) {
                labels.push('Memory Traffic ‚Üì');
                values.push(attribution.reduced_memory_traffic * 100);
                colors.push('#3b82f6');
            }
            if (attribution.improved_compute_utilization > 0.05) {
                labels.push('Compute Util ‚Üë');
                values.push(attribution.improved_compute_utilization * 100);
                colors.push('#22c55e');
            }
            if (attribution.better_cache_behavior > 0.05) {
                labels.push('Cache Behavior ‚Üë');
                values.push(attribution.better_cache_behavior * 100);
                colors.push('#a855f7');
            }
            if (attribution.kernel_fusion_overlap > 0.05) {
                labels.push('Kernel Fusion');
                values.push(attribution.kernel_fusion_overlap * 100);
                colors.push('#f97316');
            }
            if (attribution.other > 0.05) {
                labels.push('Other');
                values.push(attribution.other * 100);
                colors.push('#64748b');
            }
            
            attributionChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: values,
                        backgroundColor: colors,
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '60%',
                    plugins: {
                        legend: { 
                            position: 'right',
                            labels: { color: '#94a3b8', padding: 10 }
                        }
                    }
                }
            });
        }
        
        function renderNsysComparison(data) {
            const container = document.getElementById('nsysComparison');
            
            if (!data || data.error || !data.metrics || data.metrics.length === 0) {
                container.innerHTML = `<div class="no-data" style="padding: 2rem; text-align: center;">
                    <div class="no-data-icon">üìä</div>
                    <p style="color: var(--text-muted);">${data?.error || 'No nsys metrics available'}</p>
                </div>`;
                return;
            }
            
            let html = `<table style="width: 100%; border-collapse: collapse; font-size: 13px;">
                <thead>
                    <tr style="border-bottom: 1px solid var(--border-glass);">
                        <th style="text-align: left; padding: 0.5rem; color: var(--text-muted);">Metric</th>
                        <th style="text-align: right; padding: 0.5rem; color: var(--accent-tertiary);">Baseline</th>
                        <th style="text-align: right; padding: 0.5rem; color: var(--accent-success);">Optimized</th>
                        <th style="text-align: right; padding: 0.5rem; color: var(--accent-info);">Œî%</th>
                    </tr>
                </thead>
                <tbody>`;
            
            data.metrics.slice(0, 20).forEach(m => {
                const deltaColor = m.delta_pct > 0 ? 'var(--accent-danger)' : m.delta_pct < 0 ? 'var(--accent-success)' : 'var(--text-muted)';
                const deltaStr = m.delta_pct !== null ? `${m.delta_pct > 0 ? '+' : ''}${m.delta_pct.toFixed(1)}%` : '-';
                
                html += `<tr style="border-bottom: 1px solid var(--border-glass);">
                    <td style="padding: 0.5rem; max-width: 150px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="${m.name}">${m.name}</td>
                    <td style="padding: 0.5rem; text-align: right; font-family: 'JetBrains Mono', monospace;">${m.baseline}</td>
                    <td style="padding: 0.5rem; text-align: right; font-family: 'JetBrains Mono', monospace;">${m.optimized}</td>
                    <td style="padding: 0.5rem; text-align: right; color: ${deltaColor}; font-weight: 500;">${deltaStr}</td>
                </tr>`;
            });
            
            html += '</tbody></table>';
            container.innerHTML = html;
        }
        
        function renderNcuComparison(data) {
            const container = document.getElementById('ncuComparison');
            
            if (!data || data.error || !data.metrics || data.metrics.length === 0) {
                container.innerHTML = `<div class="no-data" style="padding: 2rem; text-align: center;">
                    <div class="no-data-icon">üî•</div>
                    <p style="color: var(--text-muted);">${data?.error || 'No ncu metrics available'}</p>
                </div>`;
                return;
            }
            
            let html = `<table style="width: 100%; border-collapse: collapse; font-size: 13px;">
                <thead>
                    <tr style="border-bottom: 1px solid var(--border-glass);">
                        <th style="text-align: left; padding: 0.5rem; color: var(--text-muted);">Metric</th>
                        <th style="text-align: right; padding: 0.5rem; color: var(--accent-tertiary);">Baseline</th>
                        <th style="text-align: right; padding: 0.5rem; color: var(--accent-success);">Optimized</th>
                        <th style="text-align: right; padding: 0.5rem; color: var(--accent-info);">Œî</th>
                    </tr>
                </thead>
                <tbody>`;
            
            data.metrics.slice(0, 20).forEach(m => {
                const deltaColor = m.delta > 0 ? 'var(--accent-danger)' : m.delta < 0 ? 'var(--accent-success)' : 'var(--text-muted)';
                const deltaStr = m.delta !== null ? (m.delta > 0 ? '+' : '') + m.delta.toFixed(2) : '-';
                
                html += `<tr style="border-bottom: 1px solid var(--border-glass);">
                    <td style="padding: 0.5rem; max-width: 150px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="${m.name}">${m.name}</td>
                    <td style="padding: 0.5rem; text-align: right; font-family: 'JetBrains Mono', monospace;">${m.baseline}</td>
                    <td style="padding: 0.5rem; text-align: right; font-family: 'JetBrains Mono', monospace;">${m.optimized}</td>
                    <td style="padding: 0.5rem; text-align: right; color: ${deltaColor}; font-weight: 500;">${deltaStr}</td>
                </tr>`;
            });
            
            html += '</tbody></table>';
            container.innerHTML = html;
        }
        
        function renderProfileRecommendations(recommendations) {
            const container = document.getElementById('profileRecommendations');
            
            if (!recommendations || recommendations.length === 0) {
                container.innerHTML = `<div style="padding: 1rem; background: var(--bg-glass); border-radius: 8px; border-left: 3px solid var(--accent-info);">
                    <span style="color: var(--text-muted);">No specific recommendations - profile with more detail for insights</span>
                </div>`;
                return;
            }
            
            container.innerHTML = recommendations.map((r, i) => {
                const colors = ['var(--accent-warning)', 'var(--accent-info)', 'var(--accent-primary)', 'var(--accent-secondary)'];
                const color = colors[i % colors.length];
                return `<div style="padding: 0.75rem 1rem; background: var(--bg-glass); border-radius: 8px; border-left: 3px solid ${color};">
                    <span style="color: ${color};">‚ö†Ô∏è</span> ${r}
                </div>`;
            }).join('');
        }
        
        function renderKernelSpeedupTable(kernelDiffs) {
            const tbody = document.getElementById('kernelSpeedupBody');
            
            if (!kernelDiffs || kernelDiffs.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 2rem; color: var(--text-muted);">No kernel data available</td></tr>';
                return;
            }
            
            tbody.innerHTML = kernelDiffs.slice(0, 15).map(kd => {
                const speedupColor = kd.speedup > 1.1 ? 'var(--accent-success)' : kd.speedup < 0.95 ? 'var(--accent-danger)' : 'var(--text-muted)';
                const bindingBadge = kd.binding_changed ? 
                    `<span style="color: var(--accent-warning); font-size: 11px;">${kd.baseline_binding} ‚Üí ${kd.optimized_binding}</span>` :
                    `<span style="color: var(--text-muted); font-size: 11px;">${kd.optimized_binding}</span>`;
                
                return `<tr style="border-bottom: 1px solid var(--border-glass);">
                    <td style="padding: 0.5rem; max-width: 180px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="${kd.name}">${kd.name}</td>
                    <td style="padding: 0.5rem; text-align: right; font-family: 'JetBrains Mono', monospace; color: var(--accent-tertiary);">${(kd.baseline_time_ms || 0).toFixed(3)}</td>
                    <td style="padding: 0.5rem; text-align: right; font-family: 'JetBrains Mono', monospace; color: var(--accent-success);">${(kd.optimized_time_ms || 0).toFixed(3)}</td>
                    <td style="padding: 0.5rem; text-align: right; color: ${speedupColor}; font-weight: 600;">${kd.speedup === Infinity ? '‚àû' : kd.speedup.toFixed(2)}x</td>
                    <td style="padding: 0.5rem; text-align: center;">${bindingBadge}</td>
                    <td style="padding: 0.5rem; font-size: 12px; color: var(--text-secondary);">${kd.primary_improvement || '-'}</td>
                </tr>`;
            }).join('');
        }
        
        // =========================================================================
        // LIVE OPTIMIZATION CONSOLE (NEW!)
        // =========================================================================
        
        let currentOptJobId = null;
        let optEventSource = null;
        let optStartTime = null;
        let optDurationInterval = null;
        let consoleFilter = 'all';
        
        async function populateOptimizeTargets() {
            try {
                const res = await fetch('/api/available');
                const data = await res.json();
                
                const select = document.getElementById('optimizeTarget');
                let options = '<option value="">Select target...</option>';
                
                if (data.chapters) {
                    data.chapters.forEach(ch => {
                        ch.benchmarks.forEach(b => {
                            options += `<option value="${ch.name}:${b.name}">${ch.name}:${b.name}</option>`;
                        });
                    });
                }
                
                if (data.labs) {
                    data.labs.forEach(lab => {
                        lab.benchmarks.forEach(b => {
                            options += `<option value="labs/${lab.name}:${b.name}">labs/${lab.name}:${b.name}</option>`;
                        });
                    });
                }
                
                select.innerHTML = options;
            } catch (e) {
                console.error('Error loading optimize targets:', e);
            }
        }
        
        async function startOptimization() {
            const target = document.getElementById('optimizeTarget').value;
            if (!target) {
                alert('Please select a target to optimize');
                return;
            }
            
            const params = {
                target: target,
                llm_analysis: document.getElementById('optLLM').checked,
                apply_patches: document.getElementById('optPatches').checked,
                rebenchmark: document.getElementById('optRebench').checked,
            };
            
            try {
                const res = await fetch('/api/optimize/start', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(params)
                });
                
                const data = await res.json();
                
                if (data.error) {
                    appendToConsole('error', data.error);
                    return;
                }
                
                currentOptJobId = data.job_id;
                optStartTime = Date.now();
                
                // Update UI
                document.getElementById('startOptBtn').style.display = 'none';
                document.getElementById('stopOptBtn').style.display = 'flex';
                document.getElementById('optStatus').textContent = 'üîÑ Running';
                document.getElementById('optStatus').style.color = 'var(--accent-primary)';
                
                // Start duration counter
                optDurationInterval = setInterval(updateDuration, 1000);
                
                // Clear console
                document.getElementById('liveConsole').innerHTML = '';
                appendToConsole('status', `üöÄ Starting optimization for ${target}...`);
                
                // Connect to SSE stream
                connectToStream(data.stream_url);
                
            } catch (e) {
                appendToConsole('error', `Failed to start: ${e.message}`);
            }
        }
        
        function connectToStream(streamUrl) {
            if (optEventSource) {
                optEventSource.close();
            }
            
            optEventSource = new EventSource(streamUrl);
            
            optEventSource.onopen = () => {
                appendToConsole('status', 'üì° Connected to optimization stream');
            };
            
            optEventSource.onerror = (e) => {
                console.error('SSE error:', e);
                if (optEventSource.readyState === EventSource.CLOSED) {
                    appendToConsole('error', '‚ùå Stream disconnected');
                    finishOptimization('disconnected');
                }
            };
            
            // Listen to different event types
            ['status', 'info', 'command', 'output', 'llm', 'benchmark', 'patch', 'success', 'error', 'speedup', 'complete', 'stopped'].forEach(type => {
                optEventSource.addEventListener(type, (e) => {
                    try {
                        const data = JSON.parse(e.data);
                        handleOptEvent(type, data);
                    } catch (err) {
                        appendToConsole(type, e.data);
                    }
                });
            });
        }
        
        function handleOptEvent(type, data) {
            const message = data.message || JSON.stringify(data);
            appendToConsole(type, message);
            
            // Update stats
            document.getElementById('optEvents').textContent = 
                parseInt(document.getElementById('optEvents').textContent) + 1;
            
            // Check for speedup in message
            const speedupMatch = message.match(/(\d+\.?\d*)x/);
            if (speedupMatch && type === 'speedup') {
                document.getElementById('optSpeedup').textContent = speedupMatch[0];
            }
            
            // Handle completion
            if (type === 'complete' || type === 'stopped') {
                finishOptimization(data.status || type);
            }
        }
        
        function appendToConsole(type, message) {
            const console = document.getElementById('liveConsole');
            
            // Remove welcome message if present
            const welcome = console.querySelector('.console-welcome');
            if (welcome) welcome.remove();
            
            const colors = {
                status: 'var(--accent-primary)',
                info: 'var(--accent-info)',
                command: '#a855f7',
                output: 'var(--text-secondary)',
                llm: '#f97316',
                benchmark: '#3b82f6',
                patch: '#22c55e',
                success: 'var(--accent-success)',
                error: 'var(--accent-danger)',
                speedup: 'var(--accent-warning)',
                complete: 'var(--accent-success)',
                stopped: 'var(--accent-warning)',
            };
            
            const icons = {
                status: 'üìç',
                info: '‚ÑπÔ∏è',
                command: '‚å®Ô∏è',
                output: '  ',
                llm: 'üß†',
                benchmark: 'üìä',
                patch: 'üîß',
                success: '‚úÖ',
                error: '‚ùå',
                speedup: '‚ö°',
                complete: 'üéâ',
                stopped: '‚èπÔ∏è',
            };
            
            const line = document.createElement('div');
            line.className = `console-line console-${type}`;
            line.style.cssText = `padding: 4px 0; color: ${colors[type] || 'var(--text-secondary)'}; ${consoleFilter !== 'all' && consoleFilter !== type ? 'display: none;' : ''}`;
            
            const timestamp = new Date().toLocaleTimeString();
            line.innerHTML = `<span style="color: var(--text-muted); margin-right: 8px;">[${timestamp}]</span>${icons[type] || ''} ${escapeHtml(message)}`;
            
            console.appendChild(line);
            console.scrollTop = console.scrollHeight;
        }
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        function updateDuration() {
            if (!optStartTime) return;
            const elapsed = Math.floor((Date.now() - optStartTime) / 1000);
            const mins = Math.floor(elapsed / 60);
            const secs = elapsed % 60;
            document.getElementById('optDuration').textContent = `${mins}:${secs.toString().padStart(2, '0')}`;
        }
        
        function finishOptimization(status) {
            if (optEventSource) {
                optEventSource.close();
                optEventSource = null;
            }
            
            if (optDurationInterval) {
                clearInterval(optDurationInterval);
                optDurationInterval = null;
            }
            
            document.getElementById('startOptBtn').style.display = 'flex';
            document.getElementById('stopOptBtn').style.display = 'none';
            
            const statusEl = document.getElementById('optStatus');
            if (status === 'completed') {
                statusEl.textContent = '‚úÖ Completed';
                statusEl.style.color = 'var(--accent-success)';
            } else if (status === 'stopped') {
                statusEl.textContent = '‚èπÔ∏è Stopped';
                statusEl.style.color = 'var(--accent-warning)';
            } else {
                statusEl.textContent = '‚ùå Failed';
                statusEl.style.color = 'var(--accent-danger)';
            }
            
            currentOptJobId = null;
        }
        
        async function stopOptimization() {
            if (!currentOptJobId) return;
            
            try {
                await fetch('/api/optimize/stop', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ job_id: currentOptJobId })
                });
                
                appendToConsole('stopped', 'Optimization stopped by user');
                finishOptimization('stopped');
            } catch (e) {
                appendToConsole('error', `Failed to stop: ${e.message}`);
            }
        }
        
        function filterConsole(filter) {
            consoleFilter = filter;
            const lines = document.querySelectorAll('.console-line');
            lines.forEach(line => {
                if (filter === 'all') {
                    line.style.display = 'block';
                } else {
                    line.style.display = line.classList.contains(`console-${filter}`) ? 'block' : 'none';
                }
            });
            
            // Update button states
            document.querySelectorAll('#tab-liveopt .chip').forEach(btn => {
                const btnFilter = btn.textContent.toLowerCase().includes('all') ? 'all' :
                                  btn.textContent.includes('LLM') ? 'llm' :
                                  btn.textContent.includes('Patch') ? 'patch' :
                                  btn.textContent.includes('Bench') ? 'benchmark' : null;
                if (btnFilter === filter) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
        }
        
        function clearConsole() {
            document.getElementById('liveConsole').innerHTML = `
                <div class="console-welcome" style="color: var(--text-muted); padding: 2rem; text-align: center;">
                    <div style="font-size: 48px; margin-bottom: 1rem;">üöÄ</div>
                    <div>Console cleared</div>
                </div>`;
            document.getElementById('optEvents').textContent = '0';
        }

        // =====================================================================
        // Analysis Tab Functions
        // =====================================================================
        
        let tradeoffChart = null;
        
        async function loadAnalysisData() {
            try {
                // Load all analysis data in parallel
                const [leaderboards, pareto, tradeoffs, recommendations, stacking, power, cost, scaling] = await Promise.all([
                    fetch('/api/analysis/leaderboards').then(r => r.json()),
                    fetch('/api/analysis/pareto').then(r => r.json()),
                    fetch('/api/analysis/tradeoffs').then(r => r.json()),
                    fetch('/api/analysis/recommendations').then(r => r.json()),
                    fetch('/api/analysis/stacking').then(r => r.json()),
                    fetch('/api/analysis/power').then(r => r.json()),
                    fetch('/api/analysis/cost').then(r => r.json()),
                    fetch('/api/analysis/scaling').then(r => r.json()),
                ]);
                
                renderLeaderboards(leaderboards);
                renderParetoLeaderboard(pareto);
                renderTradeoffChart(tradeoffs, pareto);
                renderRecommendations(recommendations);
                renderEfficiencyRankings(tradeoffs);
                renderStackingGuide(stacking);
                renderPowerEfficiency(power);
                renderCostAnalysis(cost);
                renderScalingAnalysis(scaling);
            } catch (e) {
                console.error('Failed to load analysis data:', e);
            }
        }
        
        function renderLeaderboards(data) {
            const boards = data.leaderboards || {};
            
            // Speed leaderboard
            const speedEl = document.getElementById('speedLeaderboard');
            if (boards.speed && boards.speed.entries.length > 0) {
                speedEl.innerHTML = boards.speed.entries.slice(0, 5).map(e => `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.5rem; background: var(--bg-glass); border-radius: 6px; ${e.rank <= 3 ? 'border-left: 3px solid var(--accent-success);' : ''}">
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <span style="font-weight: 600; color: ${e.rank === 1 ? '#FFD700' : e.rank === 2 ? '#C0C0C0' : e.rank === 3 ? '#CD7F32' : 'var(--text-muted)'};">#${e.rank}</span>
                            <span style="font-size: 0.85rem;">${e.name}</span>
                        </div>
                        <span style="color: var(--accent-success); font-weight: 600;">${e.primary_metric}</span>
                    </div>
                `).join('');
            } else {
                speedEl.innerHTML = '<div style="color: var(--text-muted); text-align: center;">No speed optimizations</div>';
            }
            
            // Memory leaderboard
            const memEl = document.getElementById('memoryLeaderboard');
            if (boards.memory && boards.memory.entries.length > 0) {
                memEl.innerHTML = boards.memory.entries.slice(0, 5).map(e => `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.5rem; background: var(--bg-glass); border-radius: 6px; ${e.rank <= 3 ? 'border-left: 3px solid var(--accent-info);' : ''}">
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <span style="font-weight: 600; color: ${e.rank === 1 ? '#FFD700' : e.rank === 2 ? '#C0C0C0' : e.rank === 3 ? '#CD7F32' : 'var(--text-muted)'};">#${e.rank}</span>
                            <span style="font-size: 0.85rem;">${e.name}</span>
                        </div>
                        <span style="color: var(--accent-info); font-weight: 600;">${e.primary_metric}</span>
                    </div>
                `).join('');
            } else {
                memEl.innerHTML = '<div style="color: var(--text-muted); text-align: center;">No memory optimizations</div>';
            }
        }
        
        function renderParetoLeaderboard(data) {
            const el = document.getElementById('paretoLeaderboard');
            const pareto = data.pareto_frontier || [];
            
            if (pareto.length > 0) {
                el.innerHTML = pareto.slice(0, 5).map((p, i) => `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.5rem; background: var(--bg-glass); border-radius: 6px; border-left: 3px solid var(--accent-warning);">
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <span style="font-weight: 600; color: #FFD700;">‚≠ê</span>
                            <span style="font-size: 0.85rem;">${p.name}</span>
                        </div>
                        <div style="text-align: right; font-size: 0.8rem;">
                            <div style="color: var(--accent-success);">${p.speedup.toFixed(2)}x</div>
                            <div style="color: var(--accent-info);">${p.memory_savings > 0 ? '-' + p.memory_savings.toFixed(0) + '%' : 'N/A'}</div>
                        </div>
                    </div>
                `).join('');
            } else {
                el.innerHTML = '<div style="color: var(--text-muted); text-align: center;">No Pareto-optimal benchmarks found</div>';
            }
        }
        
        function renderTradeoffChart(tradeoffs, pareto) {
            const ctx = document.getElementById('tradeoffChart');
            if (!ctx) return;
            
            if (tradeoffChart) {
                tradeoffChart.destroy();
            }
            
            const allPoints = pareto.all_points || [];
            const paretoPoints = pareto.pareto_frontier || [];
            const paretoNames = new Set(paretoPoints.map(p => p.name));
            
            // Separate regular points and Pareto points
            const regularData = allPoints.filter(p => !paretoNames.has(p.name)).map(p => ({
                x: p.speedup,
                y: p.memory_savings,
                name: p.name,
                goal: p.goal,
            }));
            
            const paretoData = paretoPoints.map(p => ({
                x: p.speedup,
                y: p.memory_savings,
                name: p.name,
                goal: p.goal,
            }));
            
            tradeoffChart = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [
                        {
                            label: 'Regular Optimizations',
                            data: regularData,
                            backgroundColor: 'rgba(255, 255, 255, 0.3)',
                            borderColor: 'rgba(255, 255, 255, 0.5)',
                            pointRadius: 6,
                        },
                        {
                            label: 'Pareto Optimal ‚≠ê',
                            data: paretoData,
                            backgroundColor: 'rgba(255, 215, 0, 0.8)',
                            borderColor: '#FFD700',
                            pointRadius: 10,
                            pointStyle: 'star',
                        },
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: 'rgba(255,255,255,0.8)' }
                        },
                        tooltip: {
                            callbacks: {
                                label: (ctx) => {
                                    const d = ctx.raw;
                                    return [
                                        d.name,
                                        `Speed: ${d.x.toFixed(2)}x`,
                                        `Memory: ${d.y > 0 ? '-' : '+'}${Math.abs(d.y).toFixed(0)}%`,
                                        `Goal: ${d.goal}`
                                    ];
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: { display: true, text: 'Speedup (higher is better)', color: 'rgba(255,255,255,0.6)' },
                            grid: { color: 'rgba(255,255,255,0.1)' },
                            ticks: { color: 'rgba(255,255,255,0.6)' },
                        },
                        y: {
                            title: { display: true, text: 'Memory Savings % (higher is better)', color: 'rgba(255,255,255,0.6)' },
                            grid: { color: 'rgba(255,255,255,0.1)' },
                            ticks: { color: 'rgba(255,255,255,0.6)' },
                        }
                    }
                }
            });
        }
        
        function renderRecommendations(data) {
            const el = document.getElementById('recommendations');
            const scenarios = data.scenarios || [];
            
            if (scenarios.length > 0) {
                el.innerHTML = scenarios.map(s => `
                    <div style="padding: 1rem; background: var(--bg-glass); border-radius: 8px; border-left: 3px solid var(--accent-primary);">
                        <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                            <span style="font-size: 1.5rem;">${s.icon}</span>
                            <strong>${s.name}</strong>
                        </div>
                        <div style="color: var(--text-secondary); font-size: 0.85rem; margin-bottom: 0.75rem;">${s.description}</div>
                        <div style="display: flex; flex-direction: column; gap: 0.25rem;">
                            ${s.recommendations.map(r => `
                                <div style="display: flex; justify-content: space-between; font-size: 0.8rem; padding: 0.25rem 0.5rem; background: rgba(255,255,255,0.03); border-radius: 4px;">
                                    <span>${r.name}</span>
                                    <span style="color: var(--accent-success);">${r.benefit}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `).join('');
            } else {
                el.innerHTML = '<div style="color: var(--text-muted); text-align: center;">No recommendations available</div>';
            }
        }
        
        function renderEfficiencyRankings(data) {
            const el = document.getElementById('efficiencyRankings');
            const tradeoffs = data.tradeoffs || [];
            
            if (tradeoffs.length > 0) {
                // Split into memory and speed specialists
                const memorySpecs = tradeoffs.filter(t => t.goal === 'memory').slice(0, 5);
                const speedSpecs = tradeoffs.filter(t => t.goal === 'speed').slice(0, 5);
                
                el.innerHTML = `
                    <div style="padding: 1rem; background: var(--bg-glass); border-radius: 8px;">
                        <h4 style="margin-bottom: 0.75rem; color: var(--accent-info);">üíæ Memory Efficiency</h4>
                        ${memorySpecs.length > 0 ? memorySpecs.map(t => `
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.5rem; border-bottom: 1px solid rgba(255,255,255,0.05);">
                                <span style="font-size: 0.85rem;">${t.name}</span>
                                <div style="text-align: right; font-size: 0.8rem;">
                                    <div style="color: var(--accent-info);">${t.benefit}</div>
                                    <div style="color: var(--text-muted);">${t.cost}</div>
                                </div>
                            </div>
                        `).join('') : '<div style="color: var(--text-muted); text-align: center; padding: 1rem;">No memory optimizations</div>'}
                    </div>
                    <div style="padding: 1rem; background: var(--bg-glass); border-radius: 8px;">
                        <h4 style="margin-bottom: 0.75rem; color: var(--accent-success);">üöÄ Speed Efficiency</h4>
                        ${speedSpecs.slice(0, 5).map(t => `
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.5rem; border-bottom: 1px solid rgba(255,255,255,0.05);">
                                <span style="font-size: 0.85rem;">${t.name}</span>
                                <div style="text-align: right; font-size: 0.8rem;">
                                    <div style="color: var(--accent-success);">${t.benefit}</div>
                                    <div style="color: var(--text-muted);">Efficiency: ${t.efficiency_score}</div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            } else {
                el.innerHTML = '<div style="color: var(--text-muted); text-align: center;">No efficiency data available</div>';
            }
        }

        async function runWhatIf() {
            const vram = document.getElementById('whatifVram').value;
            const latency = document.getElementById('whatifLatency').value;
            const memory = document.getElementById('whatifMemory').value;
            let url = '/api/analysis/whatif?';
            if (vram) url += `vram=${vram}&`;
            if (latency) url += `latency=${latency}&`;
            if (memory) url += `memory_budget=${memory}&`;
            try {
                const res = await fetch(url);
                const data = await res.json();
                renderWhatIfResults(data);
            } catch (e) { console.error('What-If query failed:', e); }
        }
        
        function renderWhatIfResults(data) {
            const el = document.getElementById('whatifResults');
            const recs = data.recommendations || [];
            if (recs.length === 0) { el.innerHTML = '<div style="color: var(--text-muted);">No matching optimizations found</div>'; return; }
            let html = '<div style="display:flex;gap:1rem;margin-bottom:1rem;"><div style="padding:0.5rem 1rem;background:var(--bg-glass);border-radius:6px;"><span style="color:var(--text-muted);">Matching:</span> <span style="color:var(--accent-success);font-weight:600;">' + data.matching_count + '</span> / ' + data.total_benchmarks + '</div></div>';
            if (data.best_for_speed) html += '<div style="padding:0.5rem;background:rgba(0,245,160,0.1);border-radius:6px;border-left:3px solid var(--accent-success);"><strong>üöÄ Best for Speed:</strong> ' + data.best_for_speed.name + ' (' + data.best_for_speed.speedup.toFixed(2) + 'x)</div>';
            if (data.best_for_memory && data.best_for_memory.memory_savings_pct > 0) html += '<div style="padding:0.5rem;background:rgba(76,201,240,0.1);border-radius:6px;border-left:3px solid var(--accent-info);"><strong>üíæ Best for Memory:</strong> ' + data.best_for_memory.name + ' (-' + data.best_for_memory.memory_savings_pct.toFixed(0) + '%)</div>';
            html += '<div style="margin-top:1rem;"><strong>Top Matches:</strong></div>';
            html += recs.slice(0, 6).map(function(r) { return '<div style="display:flex;justify-content:space-between;padding:0.4rem 0.75rem;background:var(--bg-glass);border-radius:4px;"><span>' + r.name + '</span><span style="color:var(--accent-success);font-weight:600;">' + r.speedup.toFixed(2) + 'x</span></div>'; }).join('');
            el.innerHTML = html;
        }
        
        function renderStackingGuide(data) {
            const el = document.getElementById('stackingGuide');
            const compatible = data.compatible_combinations || [];
            const incompatible = data.incompatible_combinations || [];
            const stacks = data.recommended_stacks || [];
            let html = '<div style="margin-bottom:1rem;"><strong style="color:var(--accent-success);">‚úÖ Compatible:</strong></div>';
            html += compatible.slice(0, 4).map(function(c) { return '<div style="padding:0.5rem;background:rgba(0,245,160,0.05);border-radius:6px;border-left:2px solid var(--accent-success);"><div><strong>' + c.opt1 + '</strong> + <strong>' + c.opt2 + '</strong></div><div style="font-size:0.8rem;color:var(--text-secondary);">' + c.benefit + '</div></div>'; }).join('');
            html += '<div style="margin:1rem 0 0.5rem;"><strong style="color:var(--accent-danger);">‚ùå Incompatible:</strong></div>';
            html += incompatible.slice(0, 2).map(function(c) { return '<div style="padding:0.5rem;background:rgba(255,71,87,0.05);border-radius:6px;border-left:2px solid var(--accent-danger);"><div><strong>' + c.opt1 + '</strong> + <strong>' + c.opt2 + '</strong></div><div style="font-size:0.8rem;color:var(--text-secondary);">' + c.reason + '</div></div>'; }).join('');
            html += '<div style="margin:1rem 0 0.5rem;"><strong style="color:var(--accent-primary);">üéØ Recommended Stacks:</strong></div>';
            html += stacks.map(function(s) { return '<div style="padding:0.5rem;background:var(--bg-glass);border-radius:6px;"><div style="font-weight:600;">' + s.name + '</div><div style="font-size:0.8rem;color:var(--accent-info);">' + s.stack.join(' ‚Üí ') + '</div><div style="font-size:0.8rem;color:var(--accent-success);">Expected: ' + s.expected_benefit + '</div></div>'; }).join('');
            el.innerHTML = html;
        }
        
        function renderPowerEfficiency(data) {
            const el = document.getElementById('powerEfficiency');
            const rankings = data.efficiency_rankings || [];
            let html = '<div style="display:flex;gap:1rem;margin-bottom:1rem;"><div style="padding:0.5rem 1rem;background:var(--bg-glass);border-radius:6px;"><span style="color:var(--text-muted);">Avg Power:</span> <span style="font-weight:600;">' + (data.avg_power_w ? data.avg_power_w.toFixed(0) : 'N/A') + 'W</span></div><div style="padding:0.5rem 1rem;background:var(--bg-glass);border-radius:6px;"><span style="color:var(--text-muted);">Benchmarks:</span> <span style="font-weight:600;">' + (data.total_benchmarks_with_power || 0) + '</span></div></div>';
            if (data.most_efficient) html += '<div style="padding:0.75rem;background:linear-gradient(135deg,rgba(255,215,0,0.1),rgba(255,196,61,0.1));border-radius:8px;border-left:3px solid #FFD700;margin-bottom:1rem;"><div style="font-weight:600;">üèÜ Most Efficient</div><div>' + data.most_efficient.name + '</div><div style="color:var(--accent-success);">' + (data.most_efficient.ops_per_watt ? data.most_efficient.ops_per_watt.toFixed(2) : '0') + ' ops/watt</div></div>';
            html += rankings.slice(0, 6).map(function(e, i) { return '<div style="display:flex;justify-content:space-between;padding:0.4rem 0.75rem;background:var(--bg-glass);border-radius:4px;"><span>' + (i+1) + '. ' + e.name.substring(0,30) + (e.name.length>30?'...':'') + '</span><span style="color:var(--accent-primary);">' + (e.ops_per_watt ? e.ops_per_watt.toFixed(2) : '0') + '</span></div>'; }).join('');
            el.innerHTML = html;
        }
        
        function renderCostAnalysis(data) {
            const el = document.getElementById('costAnalysis');
            const rankings = data.cost_rankings || [];
            let html = '<div style="padding:0.75rem;background:var(--bg-glass);border-radius:8px;margin-bottom:1rem;"><div style="color:var(--text-muted);font-size:0.8rem;">Assuming ' + data.assumed_gpu + ' @ $' + (data.hourly_rate ? data.hourly_rate.toFixed(2) : '0') + '/hr</div></div>';
            if (data.highest_savings) { var h=data.highest_savings; html += '<div style="padding:0.75rem;background:linear-gradient(135deg,rgba(0,245,160,0.1),rgba(76,201,240,0.1));border-radius:8px;border-left:3px solid var(--accent-success);margin-bottom:1rem;"><div style="font-weight:600;">üí∞ Highest Savings</div><div>' + h.name + '</div><div style="color:var(--accent-success);">$' + (h.baseline_cost_per_m ? h.baseline_cost_per_m.toFixed(4) : '0') + ' ‚Üí $' + (h.optimized_cost_per_m ? h.optimized_cost_per_m.toFixed(4) : '0') + ' per 1M ops</div><div style="color:var(--accent-success);font-weight:600;">' + (h.savings_pct ? h.savings_pct.toFixed(0) : '0') + '% savings</div></div>'; }
            html += rankings.slice(0, 6).map(function(c) { return '<div style="display:flex;justify-content:space-between;padding:0.4rem 0.75rem;background:var(--bg-glass);border-radius:4px;"><span>' + c.name.substring(0,25) + (c.name.length>25?'...':'') + '</span><span style="color:var(--accent-success);font-weight:600;">' + (c.savings_pct ? c.savings_pct.toFixed(0) : '0') + '%</span></div>'; }).join('');
            el.innerHTML = html;
        }
        
        function renderScalingAnalysis(data) {
            const el = document.getElementById('scalingAnalysis');
            const recs = data.scaling_recommendations || [];
            let html = '<div style="padding:0.75rem;background:var(--bg-glass);border-radius:8px;margin-bottom:1rem;"><div style="color:var(--accent-info);">üí° ' + (data.key_insight || '') + '</div></div>';
            html += '<div style="margin-bottom:0.5rem;"><strong>Scaling Tips:</strong></div>';
            html += recs.map(function(r) { return '<div style="padding:0.75rem;background:var(--bg-glass);border-radius:6px;"><div style="font-weight:600;color:var(--accent-primary);">' + r.factor + '</div><div style="font-size:0.85rem;color:var(--text-secondary);margin:0.25rem 0;">' + r.insight + '</div><div style="font-size:0.85rem;color:var(--accent-success);">‚Üí ' + r.recommendation + '</div></div>'; }).join('');
            el.innerHTML = html;
        }
        
        async function updateCostAnalysis() {
            const gpu = document.getElementById('gpuSelector').value;
            try {
                const res = await fetch('/api/analysis/cost?gpu=' + gpu);
                const data = await res.json();
                renderCostAnalysis(data);
            } catch (e) { console.error('Failed to update cost analysis:', e); }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            fetchData();
            loadProfilerData();
            loadMemoryData();
            loadCompileData();
            loadDeepProfileList();  // Load deep profile data
            loadAnalysisData();     // Load analysis data
            // Auto-refresh every 30 seconds
            setInterval(fetchData, 30000);
        });

        // Close modal on escape
        document.addEventListener('keydown', e => {
            if (e.key === 'Escape') closeModal();
        });

        // Close modal on backdrop click
        document.getElementById('detailModal').addEventListener('click', e => {
            if (e.target.classList.contains('modal-overlay')) closeModal();
        });
    </script>
</body>
</html>
